var restaurant,newMap;function ImgError(){this.classList.add("style-image-alt"),this.onmousemove=null}function toggleFav(){const e=this.classList.contains("yes");DBHelper.fav(this.dataset.id,!e),this.classList.toggle("yes");const[t,a]=e?["add","remove"]:["remove","add"];this.setAttribute("aria-label",this.getAttribute("aria-label").replace(t,a))}function format_time(e){const[,t,a,n]=new Date(e).toDateString().split(" ");return`${t} ${a}, ${n}`}document.addEventListener("DOMContentLoaded",e=>{initMap();for(const e of $$(".star"))e.addEventListener("click",function(){if(this.classList.contains("sel"))this.classList.remove("sel");else{const e=$(".star.sel");e&&e.classList.remove("sel"),this.classList.add("sel")}});$("#post-review .cls").addEventListener("click",()=>{const e=$(".star");$("#user_name").value="",e.classList.contains("sel")&&e.classList.remove("sel"),$("#post-review textarea").value=""});for(const e of $$("#post-review input, #post-review textarea"))e.addEventListener("keydown",function({keyCode:e}){27===e&&(this.value="")});$("#post-review .snd").addEventListener("click",function(){const e={restaurant_id:getParameterByName("id"),name:$("#user_name").value,rating:$(".star.sel")?$(".star.sel").className.split(" ")[1]:void 0,comments:$("#post-review textarea").value};for(const[t,a]of Object.entries(e))if(!a)return Toast.show(`${t} value is empty`);const t=`http://${location.hostname}:1337/reviews/`;fetch(t,{method:"POST",body:JSON.stringify(e)}).then(e=>{if(e.ok)return e.json();throw new Error(e.status)}).then(e=>{store.add("reviews",e).then(()=>{location.reload()})}).catch(()=>{Toast.show("Failed to add New Review to Server, We will try again later"),Sync.add({type:"rev",method:"POST",url:t,json:e}).then(()=>{})})}),addEventListener("online",Sync.do),addEventListener("offline",function(){Toast.show("You are offline!")})}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(window.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoic2lkNyIsImEiOiJjamp1OGJvd2QwMzAzM3ByejRnd2x2NXY4In0.fkA6CjOQbzCkLVqJ1Wm4lA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(t,window.newMap),restaurant=t)})}),fetchRestaurantFromURL=(e=>{if(window.restaurant)return void e(null,window.restaurant);let t=getParameterByName("id");t?(t=Number(t),DBHelper.fetchRestaurantWithReview(t,(a,n)=>{if(!n)return restaurant=n,void console.error(a);a&&Toast.show("Failed to get Reviews, try again later"),DBHelper.fetchLocalReviewsById(t).then(t=>{(restaurant=n).local_reviews=t,fillRestaurantHTML(),e(null,restaurant)})})):(error="No restaurant id in URL",e(error,null),Toast.show("Invalid URL"))}),imgHov=(({pageX:e,pageY:t,target:a})=>{const n=(e-a.offsetLeft)/a.width*100+"% "+(t-a.offsetTop)/a.height*100+"%";a.style.cssText="transform-origin: "+n}),fillRestaurantHTML=((e=window.restaurant)=>{const t=document.getElementById("restaurant-name");t.innerHTML=e.name,$("title").textContent+=e.name,$("#post-review textarea").setAttribute("placeholder",`Write your views about ${e.name}`);const a=document.createElement("button");a.textContent="❤";let n=!!e.is_favorite&&JSON.parse(e.is_favorite);const r=localStorage.getItem("loc_rest_fav");r&&(n=JSON.parse(r)[e.id]||n),a.className="is-fav"+(n?" yes":""),a.dataset.id=e.id,a.onclick=toggleFav,a.setAttribute("aria-label",`click to ${n?"remove":"add"} ${e.name} to favorite`),t.append(a),document.getElementById("restaurant-address").innerHTML=e.address;const s=document.getElementById("restaurant-img");s.className="restaurant-img",s.src=DBHelper.imageUrlForRestaurant(e.photograph),s.alt=`Image of ${e.name} Restaurant`,s.onmousemove=imgHov,s.onerror=ImgError,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=window.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let a in e){const n=document.createElement("tr"),r=document.createElement("th");r.innerHTML=a,n.appendChild(r);const s=document.createElement("td");s.innerHTML=e[a],n.appendChild(s),t.appendChild(n)}}),fillReviewsHTML=((e=window.restaurant.reviews,t=window.restaurant.local_reviews)=>{const a=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",a.appendChild(n),404===e){const e=document.createElement("p");if(e.innerHTML="Failed to Fetch reviews!",a.appendChild(e),0!==t.length){const e=document.getElementById("reviews-list");t.forEach(t=>{e.appendChild(createReviewHTML(t,!0))}),a.appendChild(e)}return}if(!e&&0===t.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void a.appendChild(e)}if(!e||404===e){const t=document.createElement("p");t.innerHTML=404===e?"Failed to Fetch reviews!":"No reviews yet!",a.appendChild(t)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),0!==t.length&&t.forEach(e=>{r.appendChild(createReviewHTML(e,!0))}),a.appendChild(r)}),star=(e=>["☆","☆","☆","☆","☆"].fill("★",0,e).join("")),createReviewHTML=((e,t)=>{const a=document.createElement("li");a.setAttribute("tabindex",0),a.setAttribute("aria-label","Review");const n=document.createElement("p");n.classList.add("user-name"),n.setAttribute("aria-label","Review by"),n.innerHTML=e.name,a.appendChild(n);const r=document.createElement("p");r.classList.add("date"),r.innerHTML=t?"Offline Review":format_time(e.createdAt),e.createdAt-e.updatedAt!=0&&(r.title=`edit: ${format_time(e.updatedAt)}`),r.setAttribute("aria-label","Review post date"),a.appendChild(r);const s=document.createElement("p");s.classList.add("rate"),s.innerHTML=`Rating: <span>${star(e.rating)}</span>`,s.setAttribute("aria-label",`Review rating - ${e.rating}`),a.appendChild(s);const i=document.createElement("p");return i.classList.add("comments"),i.innerHTML=e.comments,i.setAttribute("aria-label","Review text"),a.appendChild(i),a}),fillBreadcrumb=((e=window.restaurant)=>{const t=document.querySelector("#breadcrumb ol"),a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-current","page"),t.appendChild(a)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwiSW1nRXJyb3IiLCJ0aGlzIiwiY2xhc3NMaXN0IiwiYWRkIiwib25tb3VzZW1vdmUiLCJ0b2dnbGVGYXYiLCJzdGF0ZSIsImNvbnRhaW5zIiwiREJIZWxwZXIiLCJmYXYiLCJkYXRhc2V0IiwiaWQiLCJ0b2dnbGUiLCJhIiwiYiIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsInJlcGxhY2UiLCJmb3JtYXRfdGltZSIsInQiLCJtIiwiZGF0ZSIsInkiLCJEYXRlIiwidG9EYXRlU3RyaW5nIiwic3BsaXQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImluaXRNYXAiLCJlbCIsIiQkIiwicmVtb3ZlIiwic2VsIiwiJCIsInN0YXIiLCJ2YWx1ZSIsImtleUNvZGUiLCJwYXJhbXMiLCJyZXN0YXVyYW50X2lkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwibmFtZSIsInJhdGluZyIsImNsYXNzTmFtZSIsInVuZGVmaW5lZCIsImNvbW1lbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsIlRvYXN0Iiwic2hvdyIsInVybCIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIkVycm9yIiwic3RhdHVzIiwiZGF0YSIsInN0b3JlIiwicmVsb2FkIiwiY2F0Y2giLCJTeW5jIiwidHlwZSIsImRvIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwicmVzdCIsImNvbnNvbGUiLCJ3aW5kb3ciLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiYWRkVG8iLCJmaWxsQnJlYWRjcnVtYiIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJjYWxsYmFjayIsIk51bWJlciIsImZldGNoUmVzdGF1cmFudFdpdGhSZXZpZXciLCJlcnIiLCJmZXRjaExvY2FsUmV2aWV3c0J5SWQiLCJscmV2IiwibG9jYWxfcmV2aWV3cyIsImZpbGxSZXN0YXVyYW50SFRNTCIsImltZ0hvdiIsInBhZ2VYIiwicGFnZVkiLCJ0YXJnZXQiLCJvcmlnaW4iLCJvZmZzZXRMZWZ0Iiwid2lkdGgiLCJvZmZzZXRUb3AiLCJoZWlnaHQiLCJzdHlsZSIsImNzc1RleHQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsInRleHRDb250ZW50IiwiY3JlYXRlRWxlbWVudCIsImlzRmF2IiwiaXNfZmF2b3JpdGUiLCJwYXJzZSIsImxvY0ZhdnMiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwib25jbGljayIsImFwcGVuZCIsImFkZHJlc3MiLCJpbWFnZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInBob3RvZ3JhcGgiLCJhbHQiLCJvbmVycm9yIiwiY3Vpc2luZV90eXBlIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwicmV2aWV3cyIsImNvbnRhaW5lciIsInRpdGxlIiwicmV2NDA0IiwibGVuZ3RoIiwidWwiLCJmb3JFYWNoIiwibHIiLCJjcmVhdGVSZXZpZXdIVE1MIiwibm9SZXZpZXdzIiwicmV2aWV3IiwiciIsImZpbGwiLCJqb2luIiwiaXNMb2MiLCJsaSIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsImJyZWFkY3J1bWIiLCJxdWVyeVNlbGVjdG9yIiwiaHJlZiIsInJlc3VsdHMiLCJSZWdFeHAiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxXQUNBQyxPQTRMSixTQUFTQyxXQUNQQyxLQUFLQyxVQUFVQyxJQUFJLG1CQUNuQkYsS0FBS0csWUFBYyxLQUVyQixTQUFTQyxZQUNQLE1BQU1DLEVBQVFMLEtBQUtDLFVBQVVLLFNBQVMsT0FDdENDLFNBQVNDLElBQUlSLEtBQUtTLFFBQVFDLElBQUtMLEdBQy9CTCxLQUFLQyxVQUFVVSxPQUFPLE9BQ3RCLE1BQU9DLEVBQUdDLEdBQUtSLEVBQVEsQ0FBQyxNQUFPLFVBQVksQ0FBQyxTQUFVLE9BQ3RETCxLQUFLYyxhQUNILGFBQ0FkLEtBQUtlLGFBQWEsY0FBY0MsUUFBUUosRUFBR0MsSUErSC9DLFNBQVNJLFlBQVlDLEdBQ25CLE1BQU8sQ0FBRUMsRUFBR0MsRUFBTUMsR0FBSyxJQUFJQyxLQUFLSixHQUFHSyxlQUFlQyxNQUFNLEtBQ3hELFNBQVVMLEtBQUtDLE1BQVNDLElBblUxQkksU0FBU0MsaUJBQWlCLG1CQUFvQkMsSUFDNUNDLFVBRUEsSUFBSyxNQUFNQyxLQUFNQyxHQUFHLFNBQ2xCRCxFQUFHSCxpQkFBaUIsUUFBUyxXQUMzQixHQUFJMUIsS0FBS0MsVUFBVUssU0FBUyxPQUMxQk4sS0FBS0MsVUFBVThCLE9BQU8sV0FDakIsQ0FDTCxNQUFNQyxFQUFNQyxFQUFFLGFBQ1ZELEdBQ0ZBLEVBQUkvQixVQUFVOEIsT0FBTyxPQUV2Qi9CLEtBQUtDLFVBQVVDLElBQUksVUFNekIrQixFQUFFLHFCQUFxQlAsaUJBQWlCLFFBQVMsS0FDL0MsTUFBTVEsRUFBT0QsRUFBRSxTQUNmQSxFQUFFLGNBQWNFLE1BQVEsR0FDcEJELEVBQUtqQyxVQUFVSyxTQUFTLFFBQzFCNEIsRUFBS2pDLFVBQVU4QixPQUFPLE9BRXhCRSxFQUFFLHlCQUF5QkUsTUFBUSxLQUdyQyxJQUFLLE1BQU1OLEtBQU1DLEdBQUcsNkNBQ2xCRCxFQUFHSCxpQkFBaUIsVUFBVyxVQUFTVSxRQUFFQSxJQUN4QixLQUFaQSxJQUNGcEMsS0FBS21DLE1BQVEsTUFNbkJGLEVBQUUscUJBQXFCUCxpQkFBaUIsUUFBUyxXQUMvQyxNQUFNVyxFQUFTLENBQ2JDLGNBQWVDLG1CQUFtQixNQUNsQ0MsS0FBTVAsRUFBRSxjQUFjRSxNQUN0Qk0sT0FBUVIsRUFBRSxhQUNOQSxFQUFFLGFBQWFTLFVBQVVsQixNQUFNLEtBQUssUUFDcENtQixFQUNKQyxTQUFVWCxFQUFFLHlCQUF5QkUsT0FFdkMsSUFBSyxNQUFPdkIsRUFBR0MsS0FBTWdDLE9BQU9DLFFBQVFULEdBQ2xDLElBQUt4QixFQUNILE9BQU9rQyxNQUFNQyxRQUFRcEMsb0JBR3pCLE1BQU1xQyxZQUFnQkMsU0FBU0MseUJBQy9CQyxNQUFNSCxFQUFLLENBQUVJLE9BQVEsT0FBUUMsS0FBTUMsS0FBS0MsVUFBVW5CLEtBQy9Db0IsS0FBS0MsSUFDSixHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BRWIsTUFBTSxJQUFJQyxNQUFNSCxFQUFJSSxVQUVyQkwsS0FBS00sSUFDSkMsTUFBTTlELElBQUksVUFBVzZELEdBQU1OLEtBQUssS0FDOUJQLFNBQVNlLGFBR1pDLE1BQU0sS0FDTG5CLE1BQU1DLEtBQ0osK0RBRUZtQixLQUFLakUsSUFBSSxDQUNQa0UsS0FBTSxNQUNOZixPQUFRLE9BQ1JKLElBQUFBLEVBQ0FXLEtBQU12QixJQUNMb0IsS0FBSyxZQU1kL0IsaUJBQWlCLFNBQVV5QyxLQUFLRSxJQUVoQzNDLGlCQUFpQixVQUFXLFdBQzFCcUIsTUFBTUMsS0FBSyx3QkFPZnBCLFFBQVUsTUFDUjBDLHVCQUF1QixDQUFDQyxFQUFPQyxLQUN6QkQsRUFFRkUsUUFBUUYsTUFBTUEsSUFFZEcsT0FBTzVFLE9BQVM2RSxFQUFFQyxJQUFJLE1BQU8sQ0FDM0JDLE9BQVEsQ0FBQ0wsRUFBS00sT0FBT0MsSUFBS1AsRUFBS00sT0FBT0UsS0FDdENDLEtBQU0sR0FDTkMsaUJBQWlCLElBRW5CUCxFQUFFUSxVQUNBLG9GQUNBLENBQ0VDLFlBQ0Usd0ZBQ0ZDLFFBQVMsR0FDVEMsWUFDRSwwTkFHRjVFLEdBQUksbUJBRU42RSxNQUFNekYsUUFDUjBGLGlCQUNBakYsU0FBU2tGLHVCQUF1QmpCLEVBQU1FLE9BQU81RSxRQUM3Q0QsV0FBYTJFLE9Bd0JuQkYsdUJBQXlCb0IsQ0FBQUEsSUFDdkIsR0FBSWhCLE9BQU83RSxXQUdULFlBREE2RixFQUFTLEtBQU1oQixPQUFPN0UsWUFHeEIsSUFBSWEsRUFBSzZCLG1CQUFtQixNQUN2QjdCLEdBTUhBLEVBQUtpRixPQUFPakYsR0FDWkgsU0FBU3FGLDBCQUEwQmxGLEVBQUksQ0FBQ21GLEVBQUtyQixLQUMzQyxJQUFLQSxFQUdILE9BRkEzRSxXQUFhMkUsT0FDYkMsUUFBUUYsTUFBTXNCLEdBR1pBLEdBQ0Y5QyxNQUFNQyxLQUFLLDBDQUViekMsU0FBU3VGLHNCQUFzQnBGLEdBQUkrQyxLQUFLc0MsS0FDdENsRyxXQUFhMkUsR0FDRndCLGNBQWdCRCxFQUMzQkUscUJBQ0FQLEVBQVMsS0FBTTdGLGtCQWxCbkIwRSxNQUFRLDBCQUNSbUIsRUFBU25CLE1BQU8sTUFDaEJ4QixNQUFNQyxLQUFLLGtCQXlCZmtELE9BQVMsR0FBR0MsTUFBQUEsRUFBT0MsTUFBQUEsRUFBT0MsT0FBUXhFLE1BQ2hDLE1BQU15RSxHQUNGSCxFQUFRdEUsRUFBRzBFLFlBQWMxRSxFQUFHMkUsTUFBUyxJQUN2QyxNQUNFSixFQUFRdkUsRUFBRzRFLFdBQWE1RSxFQUFHNkUsT0FBVSxJQUN2QyxJQUNGN0UsRUFBRzhFLE1BQU1DLFFBQVUscUJBQXVCTixJQW9CNUNMLG1CQUFxQixFQUFDekIsRUFBT0UsT0FBTzdFLGNBQ2xDLE1BQU0yQyxFQUFPZixTQUFTb0YsZUFBZSxtQkFDckNyRSxFQUFLc0UsVUFBWXRDLEVBQUtoQyxLQUN0QlAsRUFBRSxTQUFTOEUsYUFBZXZDLEVBQUtoQyxLQUMvQlAsRUFBRSx5QkFBeUJuQixhQUN6Qix3Q0FDMEIwRCxFQUFLaEMsUUFFakMsTUFBTWhDLEVBQU1pQixTQUFTdUYsY0FBYyxVQUNuQ3hHLEVBQUl1RyxZQUFjLElBQ2xCLElBQUlFLElBQVF6QyxFQUFLMEMsYUFBYzNELEtBQUs0RCxNQUFNM0MsRUFBSzBDLGFBQy9DLE1BQU1FLEVBQVVDLGFBQWFDLFFBQVEsZ0JBQ2pDRixJQUNGSCxFQUFRMUQsS0FBSzRELE1BQU1DLEdBQVM1QyxFQUFLOUQsS0FBT3VHLEdBRTFDekcsRUFBSWtDLFVBQVksVUFBWXVFLEVBQVEsT0FBUyxJQUM3Q3pHLEVBQUlDLFFBQVFDLEdBQUs4RCxFQUFLOUQsR0FDdEJGLEVBQUkrRyxRQUFVbkgsVUFDZEksRUFBSU0sYUFDRix5QkFDWW1HLEVBQVEsU0FBVyxTQUFTekMsRUFBS2hDLG9CQUUvQ0EsRUFBS2dGLE9BQU9oSCxHQUVJaUIsU0FBU29GLGVBQWUsc0JBQ2hDQyxVQUFZdEMsRUFBS2lELFFBQ3pCLE1BQU1DLEVBQVFqRyxTQUFTb0YsZUFBZSxrQkFFdENhLEVBQU1oRixVQUFZLGlCQUNsQmdGLEVBQU1DLElBQU1wSCxTQUFTcUgsc0JBQXNCcEQsRUFBS3FELFlBQ2hESCxFQUFNSSxnQkFBa0J0RCxFQUFLaEMsa0JBQzdCa0YsRUFBTXZILFlBQWMrRixPQUNwQndCLEVBQU1LLFFBQVVoSSxTQUVBMEIsU0FBU29GLGVBQWUsc0JBQ2hDQyxVQUFZdEMsRUFBS3dELGFBR3JCeEQsRUFBS3lELGlCQUNQQywwQkFHRkMsb0JBTUZELHdCQUEwQixFQUN4QkUsRUFBaUIxRCxPQUFPN0UsV0FBV29JLG1CQUVuQyxNQUFNSSxFQUFRNUcsU0FBU29GLGVBQWUsb0JBQ3RDLElBQUssSUFBSXlCLEtBQU9GLEVBQWdCLENBQzlCLE1BQU1HLEVBQU05RyxTQUFTdUYsY0FBYyxNQUU3QndCLEVBQU0vRyxTQUFTdUYsY0FBYyxNQUNuQ3dCLEVBQUkxQixVQUFZd0IsRUFDaEJDLEVBQUlFLFlBQVlELEdBRWhCLE1BQU1FLEVBQU9qSCxTQUFTdUYsY0FBYyxNQUNwQzBCLEVBQUs1QixVQUFZc0IsRUFBZUUsR0FDaENDLEVBQUlFLFlBQVlDLEdBRWhCTCxFQUFNSSxZQUFZRixNQU90QkosZ0JBQWtCLEVBQ2hCUSxFQUFVakUsT0FBTzdFLFdBQVc4SSxRQUM1QjNDLEVBQWdCdEIsT0FBTzdFLFdBQVdtRyxpQkFFbEMsTUFBTTRDLEVBQVluSCxTQUFTb0YsZUFBZSxxQkFDcENnQyxFQUFRcEgsU0FBU3VGLGNBQWMsTUFJckMsR0FIQTZCLEVBQU0vQixVQUFZLFVBQ2xCOEIsRUFBVUgsWUFBWUksR0FFTixNQUFaRixFQUFpQixDQUNuQixNQUFNRyxFQUFTckgsU0FBU3VGLGNBQWMsS0FHdEMsR0FGQThCLEVBQU9oQyxVQUFZLDJCQUNuQjhCLEVBQVVILFlBQVlLLEdBQ08sSUFBekI5QyxFQUFjK0MsT0FBYyxDQUM5QixNQUFNQyxFQUFLdkgsU0FBU29GLGVBQWUsZ0JBQ25DYixFQUFjaUQsUUFBUUMsSUFDcEJGLEVBQUdQLFlBQVlVLGlCQUFpQkQsR0FBSSxNQUV0Q04sRUFBVUgsWUFBWU8sR0FFeEIsT0FHRixJQUFLTCxHQUFvQyxJQUF6QjNDLEVBQWMrQyxPQUFjLENBQzFDLE1BQU1LLEVBQVkzSCxTQUFTdUYsY0FBYyxLQUd6QyxPQUZBb0MsRUFBVXRDLFVBQVksdUJBQ3RCOEIsRUFBVUgsWUFBWVcsR0FHeEIsSUFBSVQsR0FBdUIsTUFBWkEsRUFBaUIsQ0FDOUIsTUFBTVMsRUFBWTNILFNBQVN1RixjQUFjLEtBQ3pDb0MsRUFBVXRDLFVBQXdCLE1BQVo2QixFQUFrQiwyQkFBNkIsa0JBQ3JFQyxFQUFVSCxZQUFZVyxHQUV4QixNQUFNSixFQUFLdkgsU0FBU29GLGVBQWUsZ0JBQ25DOEIsRUFBUU0sUUFBUUksSUFDZEwsRUFBR1AsWUFBWVUsaUJBQWlCRSxNQUVMLElBQXpCckQsRUFBYytDLFFBQ2hCL0MsRUFBY2lELFFBQVFDLElBQ3BCRixFQUFHUCxZQUFZVSxpQkFBaUJELEdBQUksTUFHeENOLEVBQVVILFlBQVlPLEtBT3hCOUcsS0FBT29ILENBQUFBLEdBQUssQ0FBQyxJQUFLLElBQUssSUFBSyxJQUFLLEtBQUtDLEtBQUssSUFBSyxFQUFHRCxHQUFHRSxLQUFLLEtBUTNETCxpQkFBbUIsRUFBQ0UsRUFBUUksS0FDMUIsTUFBTUMsRUFBS2pJLFNBQVN1RixjQUFjLE1BQ2xDMEMsRUFBRzVJLGFBQWEsV0FBWSxHQUM1QjRJLEVBQUc1SSxhQUFhLGFBQWMsVUFDOUIsTUFBTTBCLEVBQU9mLFNBQVN1RixjQUFjLEtBQ3BDeEUsRUFBS3ZDLFVBQVVDLElBQUksYUFDbkJzQyxFQUFLMUIsYUFBYSxhQUFjLGFBQ2hDMEIsRUFBS3NFLFVBQVl1QyxFQUFPN0csS0FDeEJrSCxFQUFHakIsWUFBWWpHLEdBRWYsTUFBTXBCLEVBQU9LLFNBQVN1RixjQUFjLEtBQ3BDNUYsRUFBS25CLFVBQVVDLElBQUksUUFDbkJrQixFQUFLMEYsVUFBWTJDLEVBQVEsaUJBQW1CeEksWUFBWW9JLEVBQU9NLFdBQzNETixFQUFPTSxVQUFZTixFQUFPTyxXQUFjLElBQzFDeEksRUFBS3lILGVBQWlCNUgsWUFBWW9JLEVBQU9PLGNBRTNDeEksRUFBS04sYUFBYSxhQUFjLG9CQUNoQzRJLEVBQUdqQixZQUFZckgsR0FFZixNQUFNcUIsRUFBU2hCLFNBQVN1RixjQUFjLEtBQ3RDdkUsRUFBT3hDLFVBQVVDLElBQUksUUFDckJ1QyxFQUFPcUUsMkJBQTZCNUUsS0FBS21ILEVBQU81RyxpQkFDaERBLEVBQU8zQixhQUFhLGdDQUFpQ3VJLEVBQU81RyxVQUM1RGlILEVBQUdqQixZQUFZaEcsR0FFZixNQUFNRyxFQUFXbkIsU0FBU3VGLGNBQWMsS0FNeEMsT0FMQXBFLEVBQVMzQyxVQUFVQyxJQUFJLFlBQ3ZCMEMsRUFBU2tFLFVBQVl1QyxFQUFPekcsU0FDNUJBLEVBQVM5QixhQUFhLGFBQWMsZUFDcEM0SSxFQUFHakIsWUFBWTdGLEdBRVI4RyxJQU1UbEUsZUFBaUIsRUFBQzNGLEVBQWE2RSxPQUFPN0UsY0FDcEMsTUFBTWdLLEVBQWFwSSxTQUFTcUksY0FBYyxrQkFDcENKLEVBQUtqSSxTQUFTdUYsY0FBYyxNQUNsQzBDLEVBQUc1QyxVQUFZakgsRUFBVzJDLEtBQzFCa0gsRUFBRzVJLGFBQWEsZUFBZ0IsUUFDaEMrSSxFQUFXcEIsWUFBWWlCLEtBTXpCbkgsbUJBQXFCLEVBQUNDLEVBQU1TLEtBQ3JCQSxJQUFLQSxFQUFNeUIsT0FBT3hCLFNBQVM2RyxNQUNoQ3ZILEVBQU9BLEVBQUt4QixRQUFRLFVBQVcsUUFDL0IsTUFDRWdKLEVBRFksSUFBSUMsY0FBY3pILHNCQUNkMEgsS0FBS2pILEdBQ3ZCLE9BQUsrRyxFQUNBQSxFQUFRLEdBQ05HLG1CQUFtQkgsRUFBUSxHQUFHaEosUUFBUSxNQUFPLE1BRDVCLEdBREgiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciByZXN0YXVyYW50O1xyXG52YXIgbmV3TWFwO1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgbWFwIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgZXZlbnQgPT4ge1xyXG4gIGluaXRNYXAoKTtcclxuICAvLyBzdGFyIHJhdGluZ1xyXG4gIGZvciAoY29uc3QgZWwgb2YgJCQoXCIuc3RhclwiKSkge1xyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZiAodGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJzZWxcIikpIHtcclxuICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgc2VsID0gJChcIi5zdGFyLnNlbFwiKTtcclxuICAgICAgICBpZiAoc2VsKSB7XHJcbiAgICAgICAgICBzZWwuY2xhc3NMaXN0LnJlbW92ZShcInNlbFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKFwic2VsXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGNsZWFyIHRoZSByZXZpZXcgaW4gcG9zdCBmb3JtXHJcbiAgJChcIiNwb3N0LXJldmlldyAuY2xzXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBjb25zdCBzdGFyID0gJChcIi5zdGFyXCIpO1xyXG4gICAgJChcIiN1c2VyX25hbWVcIikudmFsdWUgPSBcIlwiO1xyXG4gICAgaWYgKHN0YXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwic2VsXCIpKSB7XHJcbiAgICAgIHN0YXIuY2xhc3NMaXN0LnJlbW92ZShcInNlbFwiKTtcclxuICAgIH1cclxuICAgICQoXCIjcG9zdC1yZXZpZXcgdGV4dGFyZWFcIikudmFsdWUgPSBcIlwiO1xyXG4gIH0pO1xyXG4gIC8vIGVzYyB0byBjbHMgdGV4dFxyXG4gIGZvciAoY29uc3QgZWwgb2YgJCQoXCIjcG9zdC1yZXZpZXcgaW5wdXQsICNwb3N0LXJldmlldyB0ZXh0YXJlYVwiKSkge1xyXG4gICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZnVuY3Rpb24oeyBrZXlDb2RlIH0pIHtcclxuICAgICAgaWYgKGtleUNvZGUgPT09IDI3KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IFwiXCI7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gcG9zdCB0aGUgcmV2aWV3XHJcbiAgJChcIiNwb3N0LXJldmlldyAuc25kXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgcmVzdGF1cmFudF9pZDogZ2V0UGFyYW1ldGVyQnlOYW1lKFwiaWRcIiksXHJcbiAgICAgIG5hbWU6ICQoXCIjdXNlcl9uYW1lXCIpLnZhbHVlLFxyXG4gICAgICByYXRpbmc6ICQoXCIuc3Rhci5zZWxcIilcclxuICAgICAgICA/ICQoXCIuc3Rhci5zZWxcIikuY2xhc3NOYW1lLnNwbGl0KFwiIFwiKVsxXVxyXG4gICAgICAgIDogdW5kZWZpbmVkLFxyXG4gICAgICBjb21tZW50czogJChcIiNwb3N0LXJldmlldyB0ZXh0YXJlYVwiKS52YWx1ZVxyXG4gICAgfTtcclxuICAgIGZvciAoY29uc3QgW2EsIGJdIG9mIE9iamVjdC5lbnRyaWVzKHBhcmFtcykpIHtcclxuICAgICAgaWYgKCFiKSB7XHJcbiAgICAgICAgcmV0dXJuIFRvYXN0LnNob3coYCR7YX0gdmFsdWUgaXMgZW1wdHlgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgdXJsID0gYGh0dHA6Ly8ke2xvY2F0aW9uLmhvc3RuYW1lfToxMzM3L3Jldmlld3MvYDtcclxuICAgIGZldGNoKHVybCwgeyBtZXRob2Q6IFwiUE9TVFwiLCBib2R5OiBKU09OLnN0cmluZ2lmeShwYXJhbXMpIH0pXHJcbiAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuc3RhdHVzKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgICAgc3RvcmUuYWRkKFwicmV2aWV3c1wiLCBkYXRhKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgIFRvYXN0LnNob3coXHJcbiAgICAgICAgICBcIkZhaWxlZCB0byBhZGQgTmV3IFJldmlldyB0byBTZXJ2ZXIsIFdlIHdpbGwgdHJ5IGFnYWluIGxhdGVyXCJcclxuICAgICAgICApO1xyXG4gICAgICAgIFN5bmMuYWRkKHtcclxuICAgICAgICAgIHR5cGU6IFwicmV2XCIsXHJcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgdXJsLFxyXG4gICAgICAgICAganNvbjogcGFyYW1zXHJcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAvLyBsb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGFkZEV2ZW50TGlzdGVuZXIoXCJvbmxpbmVcIiwgU3luYy5kbyk7XHJcblxyXG4gIGFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIFRvYXN0LnNob3coXCJZb3UgYXJlIG9mZmxpbmUhXCIpO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwXHJcbiAqL1xyXG5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbmRvdy5uZXdNYXAgPSBMLm1hcChcIm1hcFwiLCB7XHJcbiAgICAgICAgY2VudGVyOiBbcmVzdC5sYXRsbmcubGF0LCByZXN0LmxhdGxuZy5sbmddLFxyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIEwudGlsZUxheWVyKFxyXG4gICAgICAgIFwiaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59XCIsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbWFwYm94VG9rZW46XHJcbiAgICAgICAgICAgIFwicGsuZXlKMUlqb2ljMmxrTnlJc0ltRWlPaUpqYW1wMU9HSnZkMlF3TXpBek0zQnllalJuZDJ4Mk5YWTRJbjAuZmtBNkNqT1FiekNrTFZxSjFXbTRsQVwiLFxyXG4gICAgICAgICAgbWF4Wm9vbTogMTgsXHJcbiAgICAgICAgICBhdHRyaWJ1dGlvbjpcclxuICAgICAgICAgICAgJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnICtcclxuICAgICAgICAgICAgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJyArXHJcbiAgICAgICAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxyXG4gICAgICAgICAgaWQ6IFwibWFwYm94LnN0cmVldHNcIlxyXG4gICAgICAgIH1cclxuICAgICAgKS5hZGRUbyhuZXdNYXApO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3QsIHdpbmRvdy5uZXdNYXApO1xyXG4gICAgICByZXN0YXVyYW50ID0gcmVzdDtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbmRvdy5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHdpbmRvdy5yZXN0YXVyYW50LCB3aW5kb3cubWFwKTtcclxuICAgIH1cclxuICB9KTtcclxufSAqL1xyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSBjYWxsYmFjayA9PiB7XHJcbiAgaWYgKHdpbmRvdy5yZXN0YXVyYW50KSB7XHJcbiAgICAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIGNhbGxiYWNrKG51bGwsIHdpbmRvdy5yZXN0YXVyYW50KTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgbGV0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKFwiaWRcIik7XHJcbiAgaWYgKCFpZCkge1xyXG4gICAgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9IFwiTm8gcmVzdGF1cmFudCBpZCBpbiBVUkxcIjtcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgIFRvYXN0LnNob3coXCJJbnZhbGlkIFVSTFwiKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaWQgPSBOdW1iZXIoaWQpO1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlldyhpZCwgKGVyciwgcmVzdCkgPT4ge1xyXG4gICAgICBpZiAoIXJlc3QpIHtcclxuICAgICAgICByZXN0YXVyYW50ID0gcmVzdDtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBUb2FzdC5zaG93KFwiRmFpbGVkIHRvIGdldCBSZXZpZXdzLCB0cnkgYWdhaW4gbGF0ZXJcIik7XHJcbiAgICAgIH1cclxuICAgICAgREJIZWxwZXIuZmV0Y2hMb2NhbFJldmlld3NCeUlkKGlkKS50aGVuKGxyZXYgPT4ge1xyXG4gICAgICAgIHJlc3RhdXJhbnQgPSByZXN0O1xyXG4gICAgICAgIHJlc3RhdXJhbnQubG9jYWxfcmV2aWV3cyA9IGxyZXY7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIHpvb20gYW5kIG1vdmUgaW1hZ2Ugb24gaG92ZXJcclxuICovXHJcbmltZ0hvdiA9ICh7IHBhZ2VYLCBwYWdlWSwgdGFyZ2V0OiBlbCB9KSA9PiB7XHJcbiAgY29uc3Qgb3JpZ2luID1cclxuICAgICgocGFnZVggLSBlbC5vZmZzZXRMZWZ0KSAvIGVsLndpZHRoKSAqIDEwMCArXHJcbiAgICBcIiUgXCIgK1xyXG4gICAgKChwYWdlWSAtIGVsLm9mZnNldFRvcCkgLyBlbC5oZWlnaHQpICogMTAwICtcclxuICAgIFwiJVwiO1xyXG4gIGVsLnN0eWxlLmNzc1RleHQgPSBcInRyYW5zZm9ybS1vcmlnaW46IFwiICsgb3JpZ2luO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gSW1nRXJyb3IoKSB7XHJcbiAgdGhpcy5jbGFzc0xpc3QuYWRkKFwic3R5bGUtaW1hZ2UtYWx0XCIpO1xyXG4gIHRoaXMub25tb3VzZW1vdmUgPSBudWxsO1xyXG59XHJcbmZ1bmN0aW9uIHRvZ2dsZUZhdigpIHtcclxuICBjb25zdCBzdGF0ZSA9IHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwieWVzXCIpO1xyXG4gIERCSGVscGVyLmZhdih0aGlzLmRhdGFzZXQuaWQsICFzdGF0ZSk7XHJcbiAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKFwieWVzXCIpO1xyXG4gIGNvbnN0IFthLCBiXSA9IHN0YXRlID8gW1wiYWRkXCIsIFwicmVtb3ZlXCJdIDogW1wicmVtb3ZlXCIsIFwiYWRkXCJdO1xyXG4gIHRoaXMuc2V0QXR0cmlidXRlKFxyXG4gICAgXCJhcmlhLWxhYmVsXCIsXHJcbiAgICB0aGlzLmdldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIikucmVwbGFjZShhLCBiKVxyXG4gICk7XHJcbn1cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3QgPSB3aW5kb3cucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtbmFtZVwiKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3QubmFtZTtcclxuICAkKFwidGl0bGVcIikudGV4dENvbnRlbnQgKz0gcmVzdC5uYW1lO1xyXG4gICQoXCIjcG9zdC1yZXZpZXcgdGV4dGFyZWFcIikuc2V0QXR0cmlidXRlKFxyXG4gICAgXCJwbGFjZWhvbGRlclwiLFxyXG4gICAgYFdyaXRlIHlvdXIgdmlld3MgYWJvdXQgJHtyZXN0Lm5hbWV9YFxyXG4gICk7XHJcbiAgY29uc3QgZmF2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICBmYXYudGV4dENvbnRlbnQgPSBcIuKdpFwiO1xyXG4gIGxldCBpc0ZhdiA9IHJlc3QuaXNfZmF2b3JpdGUgPyBKU09OLnBhcnNlKHJlc3QuaXNfZmF2b3JpdGUpIDogZmFsc2U7XHJcbiAgY29uc3QgbG9jRmF2cyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibG9jX3Jlc3RfZmF2XCIpO1xyXG4gIGlmIChsb2NGYXZzKSB7XHJcbiAgICBpc0ZhdiA9IEpTT04ucGFyc2UobG9jRmF2cylbcmVzdC5pZF0gfHwgaXNGYXY7XHJcbiAgfVxyXG4gIGZhdi5jbGFzc05hbWUgPSBcImlzLWZhdlwiICsgKGlzRmF2ID8gXCIgeWVzXCIgOiBcIlwiKTtcclxuICBmYXYuZGF0YXNldC5pZCA9IHJlc3QuaWQ7XHJcbiAgZmF2Lm9uY2xpY2sgPSB0b2dnbGVGYXY7XHJcbiAgZmF2LnNldEF0dHJpYnV0ZShcclxuICAgIFwiYXJpYS1sYWJlbFwiLFxyXG4gICAgYGNsaWNrIHRvICR7aXNGYXYgPyBcInJlbW92ZVwiIDogXCJhZGRcIn0gJHtyZXN0Lm5hbWV9IHRvIGZhdm9yaXRlYFxyXG4gICk7XHJcbiAgbmFtZS5hcHBlbmQoZmF2KTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1hZGRyZXNzXCIpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdC5hZGRyZXNzO1xyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWltZ1wiKTtcclxuXHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gXCJyZXN0YXVyYW50LWltZ1wiO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0LnBob3RvZ3JhcGgpO1xyXG4gIGltYWdlLmFsdCA9IGBJbWFnZSBvZiAke3Jlc3QubmFtZX0gUmVzdGF1cmFudGA7XHJcbiAgaW1hZ2Uub25tb3VzZW1vdmUgPSBpbWdIb3Y7XHJcbiAgaW1hZ2Uub25lcnJvciA9IEltZ0Vycm9yO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWN1aXNpbmVcIik7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChcclxuICBvcGVyYXRpbmdIb3VycyA9IHdpbmRvdy5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vyc1xyXG4pID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1ob3Vyc1wiKTtcclxuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIik7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmV2aWV3c0hUTUwgPSAoXHJcbiAgcmV2aWV3cyA9IHdpbmRvdy5yZXN0YXVyYW50LnJldmlld3MsXHJcbiAgbG9jYWxfcmV2aWV3cyA9IHdpbmRvdy5yZXN0YXVyYW50LmxvY2FsX3Jldmlld3NcclxuKSA9PiB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXdzLWNvbnRhaW5lclwiKTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuICB0aXRsZS5pbm5lckhUTUwgPSBcIlJldmlld3NcIjtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG5cclxuICBpZiAocmV2aWV3cyA9PT0gNDA0KSB7XHJcbiAgICBjb25zdCByZXY0MDQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgIHJldjQwNC5pbm5lckhUTUwgPSBcIkZhaWxlZCB0byBGZXRjaCByZXZpZXdzIVwiO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJldjQwNCk7XHJcbiAgICBpZiAobG9jYWxfcmV2aWV3cy5sZW5ndGggIT09IDApIHtcclxuICAgICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtbGlzdFwiKTtcclxuICAgICAgbG9jYWxfcmV2aWV3cy5mb3JFYWNoKGxyID0+IHtcclxuICAgICAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKGxyLCB0cnVlKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgaWYgKCFyZXZpZXdzICYmIGxvY2FsX3Jldmlld3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSBcIk5vIHJldmlld3MgeWV0IVwiO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGlmKCFyZXZpZXdzIHx8IHJldmlld3MgPT09IDQwNCkge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gcmV2aWV3cyA9PT0gNDA0ID8gXCJGYWlsZWQgdG8gRmV0Y2ggcmV2aWV3cyFcIiA6IFwiTm8gcmV2aWV3cyB5ZXQhXCI7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuICB9XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtbGlzdFwiKTtcclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgfSk7XHJcbiAgaWYgKGxvY2FsX3Jldmlld3MubGVuZ3RoICE9PSAwKSB7XHJcbiAgICBsb2NhbF9yZXZpZXdzLmZvckVhY2gobHIgPT4ge1xyXG4gICAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKGxyLCB0cnVlKSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiByYXRpbmdcclxuICogQHBhcmFtIHJcclxuICovXHJcbnN0YXIgPSByID0+IFtcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiXS5maWxsKFwi4piFXCIsIDAsIHIpLmpvaW4oXCJcIik7XHJcbmZ1bmN0aW9uIGZvcm1hdF90aW1lKHQpIHtcclxuICBjb25zdCBbLCBtLCBkYXRlLCB5XSA9IG5ldyBEYXRlKHQpLnRvRGF0ZVN0cmluZygpLnNwbGl0KFwiIFwiKTtcclxuICByZXR1cm4gYCR7bX0gJHtkYXRlfSwgJHt5fWA7XHJcbn1cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcsIGlzTG9jKSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgMCk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlJldmlld1wiKTtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgbmFtZS5jbGFzc0xpc3QuYWRkKFwidXNlci1uYW1lXCIpO1xyXG4gIG5hbWUuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlJldmlldyBieVwiKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgZGF0ZS5jbGFzc0xpc3QuYWRkKFwiZGF0ZVwiKTtcclxuICBkYXRlLmlubmVySFRNTCA9IGlzTG9jID8gXCJPZmZsaW5lIFJldmlld1wiIDogZm9ybWF0X3RpbWUocmV2aWV3LmNyZWF0ZWRBdCk7XHJcbiAgaWYgKHJldmlldy5jcmVhdGVkQXQgLSByZXZpZXcudXBkYXRlZEF0ICE9PSAwKSB7XHJcbiAgICBkYXRlLnRpdGxlID0gYGVkaXQ6ICR7Zm9ybWF0X3RpbWUocmV2aWV3LnVwZGF0ZWRBdCl9YDtcclxuICB9XHJcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiUmV2aWV3IHBvc3QgZGF0ZVwiKTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgcmF0aW5nLmNsYXNzTGlzdC5hZGQoXCJyYXRlXCIpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiA8c3Bhbj4ke3N0YXIocmV2aWV3LnJhdGluZyl9PC9zcGFuPmA7XHJcbiAgcmF0aW5nLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgYFJldmlldyByYXRpbmcgLSAke3Jldmlldy5yYXRpbmd9YCk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICBjb21tZW50cy5jbGFzc0xpc3QuYWRkKFwiY29tbWVudHNcIik7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJSZXZpZXcgdGV4dFwiKTtcclxuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHdpbmRvdy5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYnJlYWRjcnVtYiBvbFwiKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1jdXJyZW50XCIsIFwicGFnZVwiKTtcclxuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiBcIlwiO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTtcclxufTtcclxuIl19
