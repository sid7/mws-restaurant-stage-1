var restaurant,newMap;function ImgError(){this.classList.add("style-image-alt"),this.onmousemove=null}function toggleFav(){const e=this.classList.contains("yes");DBHelper.fav(this.dataset.id,!e),this.classList.toggle("yes");const[t,a]=e?["add","remove"]:["remove","add"];this.setAttribute("aria-label",this.getAttribute("aria-label").replace(t,a))}function format_time(e){const[,t,a,n]=new Date(e).toDateString().split(" ");return`${t} ${a}, ${n}`}document.addEventListener("DOMContentLoaded",e=>{initMap();for(const e of $$(".star"))e.addEventListener("click",function(){if(this.classList.contains("sel"))this.classList.remove("sel");else{const e=$(".star.sel");e&&e.classList.remove("sel"),this.classList.add("sel")}});$("#post-review .cls").addEventListener("click",()=>{const e=$(".star");$("#user_name").value="",e.classList.contains("sel")&&e.classList.remove("sel"),$("#post-review textarea").value=""});for(const e of $$("#post-review input, #post-review textarea"))e.addEventListener("keydown",function({keyCode:e}){27===e&&(this.value="")});$("#post-review .snd").addEventListener("click",function(){const e={restaurant_id:getParameterByName("id"),name:$("#user_name").value,rating:$(".star.sel")?$(".star.sel").className.split(" ")[1]:void 0,comments:$("#post-review textarea").value};for(const[t,a]of Object.entries(e))if(!a)return Toast.show(`${t} value is empty`);const t=`http://${location.hostname}:1337/reviews/`;fetch(t,{method:"POST",body:JSON.stringify(e)}).then(e=>{if(e.ok)return e.json();throw new Error(e.status)}).then(e=>{store.add("reviews",e).then(()=>{location.reload()})}).catch(()=>{Toast.show("Failed to add New Review to Server, We will try again later"),Sync.add({type:"rev",method:"POST",url:t,json:e}).then(()=>{})})})}),initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(window.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoic2lkNyIsImEiOiJjamp1OGJvd2QwMzAzM3ByejRnd2x2NXY4In0.fkA6CjOQbzCkLVqJ1Wm4lA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(t,window.newMap),restaurant=t)})}),fetchRestaurantFromURL=(e=>{if(window.restaurant)return void e(null,window.restaurant);let t=getParameterByName("id");t?(t=Number(t),DBHelper.fetchRestaurantWithReview(t,(a,n)=>{if(!n)return restaurant=n,void console.error(a);a&&Toast.show("Failed to get Reviews, try again later"),DBHelper.fetchLocalReviewsById(t).then(t=>{(restaurant=n).local_reviews=t,fillRestaurantHTML(),e(null,restaurant)})})):(error="No restaurant id in URL",e(error,null),Toast.show("Invalid URL"))}),imgHov=(({pageX:e,pageY:t,target:a})=>{const n=(e-a.offsetLeft)/a.width*100+"% "+(t-a.offsetTop)/a.height*100+"%";a.style.cssText="transform-origin: "+n}),fillRestaurantHTML=((e=window.restaurant)=>{const t=document.getElementById("restaurant-name");t.innerHTML=e.name,$("title").textContent+=e.name,$("#post-review textarea").setAttribute("placeholder",`Write your views about ${e.name}`);const a=document.createElement("button");a.textContent="❤";let n=!!e.is_favorite&&JSON.parse(e.is_favorite);const r=localStorage.getItem("loc_rest_fav");r&&(n=JSON.parse(r)[e.id]||n),a.className="is-fav"+(n?" yes":""),a.dataset.id=e.id,a.onclick=toggleFav,a.setAttribute("aria-label",`click to ${n?"remove":"add"} ${e.name} to favorite`),t.append(a),document.getElementById("restaurant-address").innerHTML=e.address;const s=document.getElementById("restaurant-img");s.className="restaurant-img",s.src=DBHelper.imageUrlForRestaurant(e.photograph),s.alt=`Image of ${e.name} Restaurant`,s.onmousemove=imgHov,s.onerror=ImgError,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=window.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let a in e){const n=document.createElement("tr"),r=document.createElement("th");r.innerHTML=a,n.appendChild(r);const s=document.createElement("td");s.innerHTML=e[a],n.appendChild(s),t.appendChild(n)}}),fillReviewsHTML=((e=window.restaurant.reviews,t=window.restaurant.local_reviews)=>{const a=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",a.appendChild(n),!e&&0===t.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void a.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),0!==t.length&&t.forEach(e=>{r.appendChild(createReviewHTML(e,!0))}),a.appendChild(r)}),star=(e=>["☆","☆","☆","☆","☆"].fill("★",0,e).join("")),createReviewHTML=((e,t)=>{const a=document.createElement("li");a.setAttribute("tabindex",0),a.setAttribute("aria-label","Review");const n=document.createElement("p");n.classList.add("user-name"),n.setAttribute("aria-label","Review by"),n.innerHTML=e.name,a.appendChild(n);const r=document.createElement("p");r.classList.add("date"),r.innerHTML=t?"Offline Review":format_time(e.createdAt),e.createdAt-e.updatedAt!=0&&(r.title=`edit: ${format_time(e.updatedAt)}`),r.setAttribute("aria-label","Review post date"),a.appendChild(r);const s=document.createElement("p");s.classList.add("rate"),s.innerHTML=`Rating: <span>${star(e.rating)}</span>`,s.setAttribute("aria-label",`Review rating - ${e.rating}`),a.appendChild(s);const i=document.createElement("p");return i.classList.add("comments"),i.innerHTML=e.comments,i.setAttribute("aria-label","Review text"),a.appendChild(i),a}),fillBreadcrumb=((e=window.restaurant)=>{const t=document.querySelector("#breadcrumb ol"),a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-current","page"),t.appendChild(a)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwiSW1nRXJyb3IiLCJ0aGlzIiwiY2xhc3NMaXN0IiwiYWRkIiwib25tb3VzZW1vdmUiLCJ0b2dnbGVGYXYiLCJzdGF0ZSIsImNvbnRhaW5zIiwiREJIZWxwZXIiLCJmYXYiLCJkYXRhc2V0IiwiaWQiLCJ0b2dnbGUiLCJhIiwiYiIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsInJlcGxhY2UiLCJmb3JtYXRfdGltZSIsInQiLCJtIiwiZGF0ZSIsInkiLCJEYXRlIiwidG9EYXRlU3RyaW5nIiwic3BsaXQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImluaXRNYXAiLCJlbCIsIiQkIiwicmVtb3ZlIiwic2VsIiwiJCIsInN0YXIiLCJ2YWx1ZSIsImtleUNvZGUiLCJwYXJhbXMiLCJyZXN0YXVyYW50X2lkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwibmFtZSIsInJhdGluZyIsImNsYXNzTmFtZSIsInVuZGVmaW5lZCIsImNvbW1lbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsIlRvYXN0Iiwic2hvdyIsInVybCIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIkVycm9yIiwic3RhdHVzIiwiZGF0YSIsInN0b3JlIiwicmVsb2FkIiwiY2F0Y2giLCJTeW5jIiwidHlwZSIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsInJlc3QiLCJjb25zb2xlIiwid2luZG93IiwiTCIsIm1hcCIsImNlbnRlciIsImxhdGxuZyIsImxhdCIsImxuZyIsInpvb20iLCJzY3JvbGxXaGVlbFpvb20iLCJ0aWxlTGF5ZXIiLCJtYXBib3hUb2tlbiIsIm1heFpvb20iLCJhdHRyaWJ1dGlvbiIsImFkZFRvIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJOdW1iZXIiLCJmZXRjaFJlc3RhdXJhbnRXaXRoUmV2aWV3IiwiZXJyIiwiZmV0Y2hMb2NhbFJldmlld3NCeUlkIiwibHJldiIsImxvY2FsX3Jldmlld3MiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJpbWdIb3YiLCJwYWdlWCIsInBhZ2VZIiwidGFyZ2V0Iiwib3JpZ2luIiwib2Zmc2V0TGVmdCIsIndpZHRoIiwib2Zmc2V0VG9wIiwiaGVpZ2h0Iiwic3R5bGUiLCJjc3NUZXh0IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJ0ZXh0Q29udGVudCIsImNyZWF0ZUVsZW1lbnQiLCJpc0ZhdiIsImlzX2Zhdm9yaXRlIiwicGFyc2UiLCJsb2NGYXZzIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIm9uY2xpY2siLCJhcHBlbmQiLCJhZGRyZXNzIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJwaG90b2dyYXBoIiwiYWx0Iiwib25lcnJvciIsImN1aXNpbmVfdHlwZSIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJ0aXRsZSIsImxlbmd0aCIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsciIsInIiLCJmaWxsIiwiam9pbiIsImlzTG9jIiwibGkiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJicmVhZGNydW1iIiwicXVlcnlTZWxlY3RvciIsImhyZWYiLCJyZXN1bHRzIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FDQUMsT0FzTEosU0FBU0MsV0FDUEMsS0FB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LEtBQUsrRyxFQUFPeEcsaUJBQ2hEQSxFQUFPM0IsYUFBYSxnQ0FBaUNtSSxFQUFPeEcsVUFDNUQrRyxFQUFHaEIsWUFBWS9GLEdBRWYsTUFBTUcsRUFBV25CLFNBQVNzRixjQUFjLEtBTXhDLE9BTEFuRSxFQUFTM0MsVUFBVUMsSUFBSSxZQUN2QjBDLEVBQVNpRSxVQUFZb0MsRUFBT3JHLFNBQzVCQSxFQUFTOUIsYUFBYSxhQUFjLGVBQ3BDMEksRUFBR2hCLFlBQVk1RixHQUVSNEcsSUFNVGpFLGVBQWlCLEVBQUMxRixFQUFhNEUsT0FBTzVFLGNBQ3BDLE1BQU04SixFQUFhbEksU0FBU21JLGNBQWMsa0JBQ3BDSixFQUFLL0gsU0FBU3NGLGNBQWMsTUFDbEN5QyxFQUFHM0MsVUFBWWhILEVBQVcyQyxLQUMxQmdILEVBQUcxSSxhQUFhLGVBQWdCLFFBQ2hDNkksRUFBV25CLFlBQVlnQixLQU16QmpILG1CQUFxQixFQUFDQyxFQUFNUyxLQUNyQkEsSUFBS0EsRUFBTXdCLE9BQU92QixTQUFTMkcsTUFDaENySCxFQUFPQSxFQUFLeEIsUUFBUSxVQUFXLFFBQy9CLE1BQ0U4SSxFQURZLElBQUlDLGNBQWN2SCxzQkFDZHdILEtBQUsvRyxHQUN2QixPQUFLNkcsRUFDQUEsRUFBUSxHQUNORyxtQkFBbUJILEVBQVEsR0FBRzlJLFFBQVEsTUFBTyxNQUQ1QixHQURIIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVzdGF1cmFudDtcclxudmFyIG5ld01hcDtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGV2ZW50ID0+IHtcclxuICBpbml0TWFwKCk7XHJcbiAgLy8gc3RhciByYXRpbmdcclxuICBmb3IgKGNvbnN0IGVsIG9mICQkKFwiLnN0YXJcIikpIHtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgaWYgKHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwic2VsXCIpKSB7XHJcbiAgICAgICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKFwic2VsXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHNlbCA9ICQoXCIuc3Rhci5zZWxcIik7XHJcbiAgICAgICAgaWYgKHNlbCkge1xyXG4gICAgICAgICAgc2VsLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZChcInNlbFwiKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBjbGVhciB0aGUgcmV2aWV3IGluIHBvc3QgZm9ybVxyXG4gICQoXCIjcG9zdC1yZXZpZXcgLmNsc1wiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgY29uc3Qgc3RhciA9ICQoXCIuc3RhclwiKTtcclxuICAgICQoXCIjdXNlcl9uYW1lXCIpLnZhbHVlID0gXCJcIjtcclxuICAgIGlmIChzdGFyLmNsYXNzTGlzdC5jb250YWlucyhcInNlbFwiKSkge1xyXG4gICAgICBzdGFyLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxcIik7XHJcbiAgICB9XHJcbiAgICAkKFwiI3Bvc3QtcmV2aWV3IHRleHRhcmVhXCIpLnZhbHVlID0gXCJcIjtcclxuICB9KTtcclxuICAvLyBlc2MgdG8gY2xzIHRleHRcclxuICBmb3IgKGNvbnN0IGVsIG9mICQkKFwiI3Bvc3QtcmV2aWV3IGlucHV0LCAjcG9zdC1yZXZpZXcgdGV4dGFyZWFcIikpIHtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKHsga2V5Q29kZSB9KSB7XHJcbiAgICAgIGlmIChrZXlDb2RlID09PSAyNykge1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSBcIlwiO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIHBvc3QgdGhlIHJldmlld1xyXG4gICQoXCIjcG9zdC1yZXZpZXcgLnNuZFwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIHJlc3RhdXJhbnRfaWQ6IGdldFBhcmFtZXRlckJ5TmFtZShcImlkXCIpLFxyXG4gICAgICBuYW1lOiAkKFwiI3VzZXJfbmFtZVwiKS52YWx1ZSxcclxuICAgICAgcmF0aW5nOiAkKFwiLnN0YXIuc2VsXCIpXHJcbiAgICAgICAgPyAkKFwiLnN0YXIuc2VsXCIpLmNsYXNzTmFtZS5zcGxpdChcIiBcIilbMV1cclxuICAgICAgICA6IHVuZGVmaW5lZCxcclxuICAgICAgY29tbWVudHM6ICQoXCIjcG9zdC1yZXZpZXcgdGV4dGFyZWFcIikudmFsdWVcclxuICAgIH07XHJcbiAgICBmb3IgKGNvbnN0IFthLCBiXSBvZiBPYmplY3QuZW50cmllcyhwYXJhbXMpKSB7XHJcbiAgICAgIGlmICghYikge1xyXG4gICAgICAgIHJldHVybiBUb2FzdC5zaG93KGAke2F9IHZhbHVlIGlzIGVtcHR5YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHVybCA9IGBodHRwOi8vJHtsb2NhdGlvbi5ob3N0bmFtZX06MTMzNy9yZXZpZXdzL2A7XHJcbiAgICBmZXRjaCh1cmwsIHsgbWV0aG9kOiBcIlBPU1RcIiwgYm9keTogSlNPTi5zdHJpbmdpZnkocGFyYW1zKSB9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLnN0YXR1cyk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgIHN0b3JlLmFkZChcInJldmlld3NcIiwgZGF0YSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKCgpID0+IHtcclxuICAgICAgICBUb2FzdC5zaG93KFxyXG4gICAgICAgICAgXCJGYWlsZWQgdG8gYWRkIE5ldyBSZXZpZXcgdG8gU2VydmVyLCBXZSB3aWxsIHRyeSBhZ2FpbiBsYXRlclwiXHJcbiAgICAgICAgKTtcclxuICAgICAgICBTeW5jLmFkZCh7XHJcbiAgICAgICAgICB0eXBlOiBcInJldlwiLFxyXG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgIHVybCxcclxuICAgICAgICAgIGpzb246IHBhcmFtc1xyXG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgLy8gbG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwXHJcbiAqL1xyXG5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbmRvdy5uZXdNYXAgPSBMLm1hcChcIm1hcFwiLCB7XHJcbiAgICAgICAgY2VudGVyOiBbcmVzdC5sYXRsbmcubGF0LCByZXN0LmxhdGxuZy5sbmddLFxyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIEwudGlsZUxheWVyKFxyXG4gICAgICAgIFwiaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59XCIsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbWFwYm94VG9rZW46XHJcbiAgICAgICAgICAgIFwicGsuZXlKMUlqb2ljMmxrTnlJc0ltRWlPaUpqYW1wMU9HSnZkMlF3TXpBek0zQnllalJuZDJ4Mk5YWTRJbjAuZmtBNkNqT1FiekNrTFZxSjFXbTRsQVwiLFxyXG4gICAgICAgICAgbWF4Wm9vbTogMTgsXHJcbiAgICAgICAgICBhdHRyaWJ1dGlvbjpcclxuICAgICAgICAgICAgJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnICtcclxuICAgICAgICAgICAgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJyArXHJcbiAgICAgICAgICAgICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxyXG4gICAgICAgICAgaWQ6IFwibWFwYm94LnN0cmVldHNcIlxyXG4gICAgICAgIH1cclxuICAgICAgKS5hZGRUbyhuZXdNYXApO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3QsIHdpbmRvdy5uZXdNYXApO1xyXG4gICAgICByZXN0YXVyYW50ID0gcmVzdDtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdpbmRvdy5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHdpbmRvdy5yZXN0YXVyYW50LCB3aW5kb3cubWFwKTtcclxuICAgIH1cclxuICB9KTtcclxufSAqL1xyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSBjYWxsYmFjayA9PiB7XHJcbiAgaWYgKHdpbmRvdy5yZXN0YXVyYW50KSB7XHJcbiAgICAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIGNhbGxiYWNrKG51bGwsIHdpbmRvdy5yZXN0YXVyYW50KTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgbGV0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKFwiaWRcIik7XHJcbiAgaWYgKCFpZCkge1xyXG4gICAgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9IFwiTm8gcmVzdGF1cmFudCBpZCBpbiBVUkxcIjtcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgIFRvYXN0LnNob3coXCJJbnZhbGlkIFVSTFwiKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaWQgPSBOdW1iZXIoaWQpO1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50V2l0aFJldmlldyhpZCwgKGVyciwgcmVzdCkgPT4ge1xyXG4gICAgICBpZiAoIXJlc3QpIHtcclxuICAgICAgICByZXN0YXVyYW50ID0gcmVzdDtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBUb2FzdC5zaG93KFwiRmFpbGVkIHRvIGdldCBSZXZpZXdzLCB0cnkgYWdhaW4gbGF0ZXJcIik7XHJcbiAgICAgIH1cclxuICAgICAgREJIZWxwZXIuZmV0Y2hMb2NhbFJldmlld3NCeUlkKGlkKS50aGVuKGxyZXYgPT4ge1xyXG4gICAgICAgIHJlc3RhdXJhbnQgPSByZXN0O1xyXG4gICAgICAgIHJlc3RhdXJhbnQubG9jYWxfcmV2aWV3cyA9IGxyZXY7XHJcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIHpvb20gYW5kIG1vdmUgaW1hZ2Ugb24gaG92ZXJcclxuICovXHJcbmltZ0hvdiA9ICh7IHBhZ2VYLCBwYWdlWSwgdGFyZ2V0OiBlbCB9KSA9PiB7XHJcbiAgY29uc3Qgb3JpZ2luID1cclxuICAgICgocGFnZVggLSBlbC5vZmZzZXRMZWZ0KSAvIGVsLndpZHRoKSAqIDEwMCArXHJcbiAgICBcIiUgXCIgK1xyXG4gICAgKChwYWdlWSAtIGVsLm9mZnNldFRvcCkgLyBlbC5oZWlnaHQpICogMTAwICtcclxuICAgIFwiJVwiO1xyXG4gIGVsLnN0eWxlLmNzc1RleHQgPSBcInRyYW5zZm9ybS1vcmlnaW46IFwiICsgb3JpZ2luO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gSW1nRXJyb3IoKSB7XHJcbiAgdGhpcy5jbGFzc0xpc3QuYWRkKFwic3R5bGUtaW1hZ2UtYWx0XCIpO1xyXG4gIHRoaXMub25tb3VzZW1vdmUgPSBudWxsO1xyXG59XHJcbmZ1bmN0aW9uIHRvZ2dsZUZhdigpIHtcclxuICBjb25zdCBzdGF0ZSA9IHRoaXMuY2xhc3NMaXN0LmNvbnRhaW5zKFwieWVzXCIpO1xyXG4gIERCSGVscGVyLmZhdih0aGlzLmRhdGFzZXQuaWQsICFzdGF0ZSk7XHJcbiAgdGhpcy5jbGFzc0xpc3QudG9nZ2xlKFwieWVzXCIpO1xyXG4gIGNvbnN0IFthLCBiXSA9IHN0YXRlID8gW1wiYWRkXCIsIFwicmVtb3ZlXCJdIDogW1wicmVtb3ZlXCIsIFwiYWRkXCJdO1xyXG4gIHRoaXMuc2V0QXR0cmlidXRlKFxyXG4gICAgXCJhcmlhLWxhYmVsXCIsXHJcbiAgICB0aGlzLmdldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIikucmVwbGFjZShhLCBiKVxyXG4gICk7XHJcbn1cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3QgPSB3aW5kb3cucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnQtbmFtZVwiKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3QubmFtZTtcclxuICAkKFwidGl0bGVcIikudGV4dENvbnRlbnQgKz0gcmVzdC5uYW1lO1xyXG4gICQoXCIjcG9zdC1yZXZpZXcgdGV4dGFyZWFcIikuc2V0QXR0cmlidXRlKFxyXG4gICAgXCJwbGFjZWhvbGRlclwiLFxyXG4gICAgYFdyaXRlIHlvdXIgdmlld3MgYWJvdXQgJHtyZXN0Lm5hbWV9YFxyXG4gICk7XHJcbiAgY29uc3QgZmF2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICBmYXYudGV4dENvbnRlbnQgPSBcIuKdpFwiO1xyXG4gIGxldCBpc0ZhdiA9IHJlc3QuaXNfZmF2b3JpdGUgPyBKU09OLnBhcnNlKHJlc3QuaXNfZmF2b3JpdGUpIDogZmFsc2U7XHJcbiAgY29uc3QgbG9jRmF2cyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibG9jX3Jlc3RfZmF2XCIpO1xyXG4gIGlmIChsb2NGYXZzKSB7XHJcbiAgICBpc0ZhdiA9IEpTT04ucGFyc2UobG9jRmF2cylbcmVzdC5pZF0gfHwgaXNGYXY7XHJcbiAgfVxyXG4gIGZhdi5jbGFzc05hbWUgPSBcImlzLWZhdlwiICsgKGlzRmF2ID8gXCIgeWVzXCIgOiBcIlwiKTtcclxuICBmYXYuZGF0YXNldC5pZCA9IHJlc3QuaWQ7XHJcbiAgZmF2Lm9uY2xpY2sgPSB0b2dnbGVGYXY7XHJcbiAgZmF2LnNldEF0dHJpYnV0ZShcclxuICAgIFwiYXJpYS1sYWJlbFwiLFxyXG4gICAgYGNsaWNrIHRvICR7aXNGYXYgPyBcInJlbW92ZVwiIDogXCJhZGRcIn0gJHtyZXN0Lm5hbWV9IHRvIGZhdm9yaXRlYFxyXG4gICk7XHJcbiAgbmFtZS5hcHBlbmQoZmF2KTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1hZGRyZXNzXCIpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdC5hZGRyZXNzO1xyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWltZ1wiKTtcclxuXHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gXCJyZXN0YXVyYW50LWltZ1wiO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0LnBob3RvZ3JhcGgpO1xyXG4gIGltYWdlLmFsdCA9IGBJbWFnZSBvZiAke3Jlc3QubmFtZX0gUmVzdGF1cmFudGA7XHJcbiAgaW1hZ2Uub25tb3VzZW1vdmUgPSBpbWdIb3Y7XHJcbiAgaW1hZ2Uub25lcnJvciA9IEltZ0Vycm9yO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXN0YXVyYW50LWN1aXNpbmVcIik7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChcclxuICBvcGVyYXRpbmdIb3VycyA9IHdpbmRvdy5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vyc1xyXG4pID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzdGF1cmFudC1ob3Vyc1wiKTtcclxuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcclxuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIik7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcclxuXHJcbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmV2aWV3c0hUTUwgPSAoXHJcbiAgcmV2aWV3cyA9IHdpbmRvdy5yZXN0YXVyYW50LnJldmlld3MsXHJcbiAgbG9jYWxfcmV2aWV3cyA9IHdpbmRvdy5yZXN0YXVyYW50LmxvY2FsX3Jldmlld3NcclxuKSA9PiB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXdzLWNvbnRhaW5lclwiKTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJoMlwiKTtcclxuICB0aXRsZS5pbm5lckhUTUwgPSBcIlJldmlld3NcIjtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG5cclxuICBpZiAoIXJldmlld3MgJiYgbG9jYWxfcmV2aWV3cy5sZW5ndGggPT09IDApIHtcclxuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9IFwiTm8gcmV2aWV3cyB5ZXQhXCI7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld3MtbGlzdFwiKTtcclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgfSk7XHJcbiAgaWYgKGxvY2FsX3Jldmlld3MubGVuZ3RoICE9PSAwKSB7XHJcbiAgICBsb2NhbF9yZXZpZXdzLmZvckVhY2gobHIgPT4ge1xyXG4gICAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKGxyLCB0cnVlKSk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiByYXRpbmdcclxuICogQHBhcmFtIHJcclxuICovXHJcbnN0YXIgPSByID0+IFtcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiLCBcIuKYhlwiXS5maWxsKFwi4piFXCIsIDAsIHIpLmpvaW4oXCJcIik7XHJcbmZ1bmN0aW9uIGZvcm1hdF90aW1lKHQpIHtcclxuICBjb25zdCBbLCBtLCBkYXRlLCB5XSA9IG5ldyBEYXRlKHQpLnRvRGF0ZVN0cmluZygpLnNwbGl0KFwiIFwiKTtcclxuICByZXR1cm4gYCR7bX0gJHtkYXRlfSwgJHt5fWA7XHJcbn1cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcsIGlzTG9jKSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgMCk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlJldmlld1wiKTtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgbmFtZS5jbGFzc0xpc3QuYWRkKFwidXNlci1uYW1lXCIpO1xyXG4gIG5hbWUuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBcIlJldmlldyBieVwiKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgZGF0ZS5jbGFzc0xpc3QuYWRkKFwiZGF0ZVwiKTtcclxuICBkYXRlLmlubmVySFRNTCA9IGlzTG9jID8gXCJPZmZsaW5lIFJldmlld1wiIDogZm9ybWF0X3RpbWUocmV2aWV3LmNyZWF0ZWRBdCk7XHJcbiAgaWYgKHJldmlldy5jcmVhdGVkQXQgLSByZXZpZXcudXBkYXRlZEF0ICE9PSAwKSB7XHJcbiAgICBkYXRlLnRpdGxlID0gYGVkaXQ6ICR7Zm9ybWF0X3RpbWUocmV2aWV3LnVwZGF0ZWRBdCl9YDtcclxuICB9XHJcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiUmV2aWV3IHBvc3QgZGF0ZVwiKTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgcmF0aW5nLmNsYXNzTGlzdC5hZGQoXCJyYXRlXCIpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiA8c3Bhbj4ke3N0YXIocmV2aWV3LnJhdGluZyl9PC9zcGFuPmA7XHJcbiAgcmF0aW5nLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgYFJldmlldyByYXRpbmcgLSAke3Jldmlldy5yYXRpbmd9YCk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICBjb21tZW50cy5jbGFzc0xpc3QuYWRkKFwiY29tbWVudHNcIik7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJSZXZpZXcgdGV4dFwiKTtcclxuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XHJcblxyXG4gIHJldHVybiBsaTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHdpbmRvdy5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYnJlYWRjcnVtYiBvbFwiKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaVwiKTtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuc2V0QXR0cmlidXRlKFwiYXJpYS1jdXJyZW50XCIsIFwicGFnZVwiKTtcclxuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiBcIlwiO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTtcclxufTtcclxuIl19
