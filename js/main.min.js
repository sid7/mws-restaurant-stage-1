var restaurants,neighborhoods,cuisines,newMap,markers=[];function ImgError(){this.classList.add("style-image-alt"),this.onmousemove=null}function toggleFav(){const e=this.classList.contains("yes");DBHelper.fav(this.dataset.id,!e),this.classList.toggle("yes");const[t,a]=e?["add","remove"]:["remove","add"];this.setAttribute("aria-label",this.getAttribute("aria-label").replace(t,a))}document.addEventListener("DOMContentLoaded",()=>{initMap(),fetchNeighborhoods(),fetchCuisines(),addEventListener("online",Sync.do),addEventListener("offline",function(){Toast.show("You are offline!")})}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const a=document.createElement("option");a.innerHTML=e,a.value=e,t.append(a)})}),initMap=(()=>{newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1Ijoic2lkNyIsImEiOiJjamp1OGJvd2QwMzAzM3ByejRnd2x2NXY4In0.fkA6CjOQbzCkLVqJ1Wm4lA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,n=t.selectedIndex,o=e[a].value,s=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{restaurants=[],document.getElementById("restaurants-list").innerHTML="",markers&&markers.forEach(e=>e.remove()),markers=[],restaurants=e}),fillRestaurantsHTML=((e=restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),imgHov=(({pageX:e,pageY:t,target:a})=>{const n=(e-a.offsetLeft)/a.width*100+"% "+(t-a.offsetTop)/a.height*100+"%";a.style.cssText="transform-origin: "+n}),createRestaurantHTML=(e=>{const t=document.createElement("li"),a=document.createElement("div");t.setAttribute("tabindex",0),a.className="img-container";const n=document.createElement("img");n.className="restaurant-img",n.src=DBHelper.imageUrlForRestaurant(e.photograph),n.alt=`Image of ${e.name} Restaurant`,n.onmousemove=imgHov,n.onerror=ImgError,a.append(n),t.append(a);const o=document.createElement("h2");o.innerHTML=e.name,t.append(o);const s=document.createElement("button");s.textContent="❤";let r=!!e.is_favorite&&JSON.parse(e.is_favorite);const i=localStorage.getItem("loc_rest_fav");i&&(r=JSON.parse(i)[e.id]||r),s.className="is-fav"+(r?" yes":""),s.dataset.id=e.id,s.onclick=toggleFav,s.setAttribute("aria-label",`click to ${r?"remove":"add"} ${e.name} to favorite`),o.append(s);const c=document.createElement("p");c.innerHTML=e.neighborhood,t.append(c);const l=document.createElement("p");l.innerHTML=e.address,t.append(l);const d=document.createElement("a");return d.innerHTML="View Details",d.href=DBHelper.urlForRestaurant(e),d.setAttribute("aria-label",`Click to open ${e.name}'s details page`),t.append(d),t}),addMarkersToMap=((e=restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,newMap);t.on("click",function(){window.location.href=t.options.url}),markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJuZXdNYXAiLCJtYXJrZXJzIiwiSW1nRXJyb3IiLCJ0aGlzIiwiY2xhc3NMaXN0IiwiYWRkIiwib25tb3VzZW1vdmUiLCJ0b2dnbGVGYXYiLCJzdGF0ZSIsImNvbnRhaW5zIiwiREJIZWxwZXIiLCJmYXYiLCJkYXRhc2V0IiwiaWQiLCJ0b2dnbGUiLCJhIiwiYiIsInNldEF0dHJpYnV0ZSIsImdldEF0dHJpYnV0ZSIsInJlcGxhY2UiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJpbml0TWFwIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsIlN5bmMiLCJkbyIsIlRvYXN0Iiwic2hvdyIsImVycm9yIiwibiIsImNvbnNvbGUiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImZvckVhY2giLCJuZWlnaGJvcmhvb2QiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJjIiwiZmlsbEN1aXNpbmVzSFRNTCIsImN1aXNpbmUiLCJMIiwibWFwIiwiY2VudGVyIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiYWRkVG8iLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc3RzIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtYXJrZXIiLCJyZW1vdmUiLCJ1bCIsInJlc3QiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImltZ0hvdiIsInBhZ2VYIiwicGFnZVkiLCJ0YXJnZXQiLCJlbCIsIm9yaWdpbiIsIm9mZnNldExlZnQiLCJ3aWR0aCIsIm9mZnNldFRvcCIsImhlaWdodCIsInN0eWxlIiwiY3NzVGV4dCIsImxpIiwiY29udGFpbmVyIiwiY2xhc3NOYW1lIiwiaW1hZ2UiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJwaG90b2dyYXBoIiwiYWx0IiwibmFtZSIsIm9uZXJyb3IiLCJ0ZXh0Q29udGVudCIsImlzRmF2IiwiaXNfZmF2b3JpdGUiLCJKU09OIiwicGFyc2UiLCJsb2NGYXZzIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIm9uY2xpY2siLCJuZWlnaGJvcmhvb2RIVE1MIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwidXJsRm9yUmVzdGF1cmFudCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJvbiIsIndpbmRvdyIsImxvY2F0aW9uIiwib3B0aW9ucyIsInVybCIsInB1c2giXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFlBQWFDLGNBQWVDLFNBQzVCQyxPQUNBQyxRQUFVLEdBcUtkLFNBQVNDLFdBQ1BDLEtBQUtDLFVBQVVDLElBQUksbUJBQ25CRixLQUFLRyxZQUFjLEtBRXJCLFNBQVNDLFlBQ1AsTUFBTUMsRUFBUUwsS0FBS0MsVUFBVUssU0FBUyxPQUN0Q0MsU0FBU0MsSUFBSVIsS0FBS1MsUUFBUUMsSUFBS0wsR0FDL0JMLEtBQUtDLFVBQVVVLE9BQU8sT0FDdEIsTUFBT0MsRUFBR0MsR0FBS1IsRUFBUSxDQUFDLE1BQU8sVUFBWSxDQUFDLFNBQVUsT0FDdERMLEtBQUtjLGFBQWEsYUFBY2QsS0FBS2UsYUFBYSxjQUFjQyxRQUFRSixFQUFHQyxJQXpLN0VJLFNBQVNDLGlCQUFpQixtQkFBb0IsS0FDNUNDLFVBQ0FDLHFCQUNBQyxnQkFFQUgsaUJBQWlCLFNBQVVJLEtBQUtDLElBQ2hDTCxpQkFBaUIsVUFBVyxXQUMxQk0sTUFBTUMsS0FBSyx3QkFPZkwsbUJBQXFCLE1BQ25CYixTQUFTYSxtQkFBbUIsQ0FBQ00sRUFBT0MsS0FDOUJELEVBRUZFLFFBQVFGLE1BQU1BLElBRWQvQixjQUFnQmdDLEVBQ2hCRSw2QkFRTkEsc0JBQXdCLEVBQUNGLEVBQUloQyxpQkFDM0IsTUFBTW1DLEVBQVNiLFNBQVNjLGVBQWUsd0JBQ3ZDSixFQUFFSyxRQUFRQyxJQUNSLE1BQU1DLEVBQVNqQixTQUFTa0IsY0FBYyxVQUN0Q0QsRUFBT0UsVUFBWUgsRUFDbkJDLEVBQU9HLE1BQVFKLEVBQ2ZILEVBQU9RLE9BQU9KLE9BT2xCYixjQUFnQixNQUNkZCxTQUFTYyxjQUFjLENBQUNLLEVBQU9hLEtBQ3pCYixFQUVGRSxRQUFRRixNQUFNQSxJQUVkOUIsU0FBVzJDLEVBQ1hDLHdCQVFOQSxpQkFBbUIsRUFBQ0QsRUFBSTNDLFlBQ3RCLE1BQU1rQyxFQUFTYixTQUFTYyxlQUFlLG1CQUV2Q1EsRUFBRVAsUUFBUVMsSUFDUixNQUFNUCxFQUFTakIsU0FBU2tCLGNBQWMsVUFDdENELEVBQU9FLFVBQVlLLEVBQ25CUCxFQUFPRyxNQUFRSSxFQUNmWCxFQUFPUSxPQUFPSixPQU9sQmYsUUFBVSxNQUNSdEIsT0FBUzZDLEVBQUVDLElBQUksTUFBTyxDQUNwQkMsT0FBUSxDQUFDLFdBQVksV0FDckJDLEtBQU0sR0FDTkMsaUJBQWlCLElBRW5CSixFQUFFSyxVQUFVLG9GQUFxRixDQUMvRkMsWUFBYSx3RkFDYkMsUUFBUyxHQUNUQyxZQUFhLDBOQUdieEMsR0FBSSxtQkFDSHlDLE1BQU10RCxRQUVUdUQsc0JBa0JGQSxrQkFBb0IsTUFDbEIsTUFBTUMsRUFBVXBDLFNBQVNjLGVBQWUsbUJBQ2xDdUIsRUFBVXJDLFNBQVNjLGVBQWUsd0JBRWxDd0IsRUFBU0YsRUFBUUcsY0FDakJDLEVBQVNILEVBQVFFLGNBRWpCakIsRUFBSWMsRUFBUUUsR0FBUWxCLE1BQ3BCVixFQUFJMkIsRUFBUUcsR0FBUXBCLE1BRTFCOUIsU0FBU21ELHdDQUF3Q25CLEVBQUdaLEVBQUcsQ0FBQ0QsRUFBT2lDLEtBQ3pEakMsRUFDRkUsUUFBUUYsTUFBTUEsSUFFZGtDLGlCQUFpQkQsR0FDakJFLDJCQVFORCxpQkFBbUJELENBQUFBLElBRWpCakUsWUFBYyxHQUNIdUIsU0FBU2MsZUFBZSxvQkFDaENLLFVBQVksR0FHWHRDLFNBQ0ZBLFFBQVFrQyxRQUFROEIsR0FBVUEsRUFBT0MsVUFFbkNqRSxRQUFVLEdBQ1ZKLFlBQWNpRSxJQU1oQkUsb0JBQXNCLEVBQUNGLEVBQVFqRSxlQUM3QixNQUFNc0UsRUFBSy9DLFNBQVNjLGVBQWUsb0JBQ25DNEIsRUFBTTNCLFFBQVFpQyxJQUNaRCxFQUFHMUIsT0FBTzRCLHFCQUFxQkQsTUFFakNFLG9CQU1GQyxPQUFTLEdBQUdDLE1BQUFBLEVBQU9DLE1BQUFBLEVBQU9DLE9BQVFDLE1BQ2hDLE1BQU1DLEdBQVdKLEVBQVFHLEVBQUdFLFlBQWNGLEVBQUdHLE1BQVMsSUFBTSxNQUFTTCxFQUFRRSxFQUFHSSxXQUFhSixFQUFHSyxPQUFVLElBQU0sSUFDaEhMLEVBQUdNLE1BQU1DLFFBQVUscUJBQXVCTixJQWlCNUNQLHFCQUF1QkQsQ0FBQUEsSUFDckIsTUFBTWUsRUFBSy9ELFNBQVNrQixjQUFjLE1BQzVCOEMsRUFBWWhFLFNBQVNrQixjQUFjLE9BQ3pDNkMsRUFBR2xFLGFBQWEsV0FBWSxHQUM1Qm1FLEVBQVVDLFVBQVksZ0JBRXRCLE1BQU1DLEVBQVFsRSxTQUFTa0IsY0FBYyxPQUNyQ2dELEVBQU1ELFVBQVksaUJBQ2xCQyxFQUFNQyxJQUFNN0UsU0FBUzhFLHNCQUFzQnBCLEVBQUtxQixZQUNoREgsRUFBTUksZ0JBQWtCdEIsRUFBS3VCLGtCQUM3QkwsRUFBTWhGLFlBQWNpRSxPQUNwQmUsRUFBTU0sUUFBVTFGLFNBRWhCa0YsRUFBVTNDLE9BQU82QyxHQUNqQkgsRUFBRzFDLE9BQU8yQyxHQUVWLE1BQU1PLEVBQU92RSxTQUFTa0IsY0FBYyxNQUNwQ3FELEVBQUtwRCxVQUFZNkIsRUFBS3VCLEtBQ3RCUixFQUFHMUMsT0FBT2tELEdBRVYsTUFBTWhGLEVBQU1TLFNBQVNrQixjQUFjLFVBQ25DM0IsRUFBSWtGLFlBQWMsSUFDbEIsSUFBSUMsSUFBUTFCLEVBQUsyQixhQUFjQyxLQUFLQyxNQUFNN0IsRUFBSzJCLGFBQy9DLE1BQU1HLEVBQVVDLGFBQWFDLFFBQVEsZ0JBQ2xDRixJQUNESixFQUFRRSxLQUFLQyxNQUFNQyxHQUFTOUIsRUFBS3ZELEtBQU9pRixHQUUxQ25GLEVBQUkwRSxVQUFZLFVBQVlTLEVBQVEsT0FBUyxJQUM3Q25GLEVBQUlDLFFBQVFDLEdBQUt1RCxFQUFLdkQsR0FDdEJGLEVBQUkwRixRQUFVOUYsVUFDZEksRUFBSU0sYUFDRix5QkFDWTZFLEVBQVEsU0FBVyxTQUFTMUIsRUFBS3VCLG9CQUUvQ0EsRUFBS2xELE9BQU85QixHQUVaLE1BQU0yRixFQUFtQmxGLFNBQVNrQixjQUFjLEtBQ2hEZ0UsRUFBaUIvRCxVQUFZNkIsRUFBS2hDLGFBQ2xDK0MsRUFBRzFDLE9BQU82RCxHQUVWLE1BQU1DLEVBQVVuRixTQUFTa0IsY0FBYyxLQUN2Q2lFLEVBQVFoRSxVQUFZNkIsRUFBS21DLFFBQ3pCcEIsRUFBRzFDLE9BQU84RCxHQUVWLE1BQU1DLEVBQU9wRixTQUFTa0IsY0FBYyxLQU1wQyxPQUxBa0UsRUFBS2pFLFVBQVksZUFDakJpRSxFQUFLQyxLQUFPL0YsU0FBU2dHLGlCQUFpQnRDLEdBQ3RDb0MsRUFBS3ZGLGFBQWEsOEJBQStCbUQsRUFBS3VCLHVCQUN0RFIsRUFBRzFDLE9BQU8rRCxHQUVIckIsSUFNVGIsZ0JBQWtCLEVBQUNSLEVBQVFqRSxlQUN6QmlFLEVBQU0zQixRQUFRaUMsSUFFWixNQUFNSCxFQUFTdkQsU0FBU2lHLHVCQUF1QnZDLEVBQU1wRSxRQUNyRGlFLEVBQU8yQyxHQUFHLFFBQ1YsV0FDRUMsT0FBT0MsU0FBU0wsS0FBT3hDLEVBQU84QyxRQUFRQyxNQUV4Qy9HLFFBQVFnSCxLQUFLaEQiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVzdGF1cmFudHMsIG5laWdoYm9yaG9vZHMsIGN1aXNpbmVzO1xyXG52YXIgbmV3TWFwO1xyXG52YXIgbWFya2VycyA9IFtdO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xyXG4gIGluaXRNYXAoKTsgLy8gYWRkZWRcclxuICBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbiAgXHJcbiAgYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCBTeW5jLmRvKTtcclxuICBhZGRFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBUb2FzdC5zaG93KFwiWW91IGFyZSBvZmZsaW5lIVwiKTtcclxuICB9KTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG4pID0+IHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBuZWlnaGJvcmhvb2RzID0gbjtcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuID0gbmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmVpZ2hib3Job29kcy1zZWxlY3RcIik7XHJcbiAgbi5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKChlcnJvciwgYykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjdWlzaW5lcyA9IGM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cclxuICovXHJcbmZpbGxDdWlzaW5lc0hUTUwgPSAoYyA9IGN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdWlzaW5lcy1zZWxlY3RcIik7XHJcblxyXG4gIGMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcclxuICAgIGNlbnRlcjogWzQwLjcyMjIxNiwgLTczLjk4NzUwMV0sXHJcbiAgICB6b29tOiAxMixcclxuICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcclxuICB9KTtcclxuICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xyXG4gICAgbWFwYm94VG9rZW46ICdway5leUoxSWpvaWMybGtOeUlzSW1FaU9pSmphbXAxT0dKdmQyUXdNekF6TTNCeWVqUm5kMngyTlhZNEluMC5ma0E2Q2pPUWJ6Q2tMVnFKMVdtNGxBJyxcclxuICAgIG1heFpvb206IDE4LFxyXG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArXHJcbiAgICAgICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICcgK1xyXG4gICAgICAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcclxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnXHJcbiAgfSkuYWRkVG8obmV3TWFwKTtcclxuXHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufVxyXG4vKiB3aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBsZXQgbG9jID0ge1xyXG4gICAgbGF0OiA0MC43MjIyMTYsXHJcbiAgICBsbmc6IC03My45ODc1MDFcclxuICB9O1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG59ICovXHJcblxyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG5cclxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG5cclxuICBjb25zdCBjID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xyXG4gIGNvbnN0IG4gPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjLCBuLCAoZXJyb3IsIHJlc3RzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdHMpO1xyXG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSByZXN0cyA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3RhdXJhbnRzLWxpc3RcIik7XHJcbiAgdWwuaW5uZXJIVE1MID0gXCJcIjtcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIGlmIChtYXJrZXJzKSB7XHJcbiAgICBtYXJrZXJzLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5yZW1vdmUoKSk7XHJcbiAgfVxyXG4gIG1hcmtlcnMgPSBbXTtcclxuICByZXN0YXVyYW50cyA9IHJlc3RzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RzID0gcmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdHMuZm9yRWFjaChyZXN0ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0KSk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiB6b29tIGFuZCBtb3ZlIGltYWdlIG9uIGhvdmVyXHJcbiAqL1xyXG5pbWdIb3YgPSAoeyBwYWdlWCwgcGFnZVksIHRhcmdldDogZWwgfSkgPT4ge1xyXG4gIGNvbnN0IG9yaWdpbiA9ICgocGFnZVggLSBlbC5vZmZzZXRMZWZ0KSAvIGVsLndpZHRoKSAqIDEwMCArICclICcgKyAoKHBhZ2VZIC0gZWwub2Zmc2V0VG9wKSAvIGVsLmhlaWdodCkgKiAxMDAgKyAnJSc7XHJcbiAgZWwuc3R5bGUuY3NzVGV4dCA9ICd0cmFuc2Zvcm0tb3JpZ2luOiAnICsgb3JpZ2luO1xyXG59XHJcblxyXG5mdW5jdGlvbiBJbWdFcnJvcigpIHtcclxuICB0aGlzLmNsYXNzTGlzdC5hZGQoXCJzdHlsZS1pbWFnZS1hbHRcIik7XHJcbiAgdGhpcy5vbm1vdXNlbW92ZSA9IG51bGw7XHJcbn1cclxuZnVuY3Rpb24gdG9nZ2xlRmF2KCkge1xyXG4gIGNvbnN0IHN0YXRlID0gdGhpcy5jbGFzc0xpc3QuY29udGFpbnMoXCJ5ZXNcIik7XHJcbiAgREJIZWxwZXIuZmF2KHRoaXMuZGF0YXNldC5pZCwgIXN0YXRlKTtcclxuICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoXCJ5ZXNcIik7XHJcbiAgY29uc3QgW2EsIGJdID0gc3RhdGUgPyBbXCJhZGRcIiwgXCJyZW1vdmVcIl0gOiBbXCJyZW1vdmVcIiwgXCJhZGRcIl07XHJcbiAgdGhpcy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMuZ2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiKS5yZXBsYWNlKGEsIGIpKTtcclxufVxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gcmVzdCA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwibGlcIik7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBsaS5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCAwKTtcclxuICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJpbWctY29udGFpbmVyXCI7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSBcInJlc3RhdXJhbnQtaW1nXCI7XHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3QucGhvdG9ncmFwaCk7XHJcbiAgaW1hZ2UuYWx0ID0gYEltYWdlIG9mICR7cmVzdC5uYW1lfSBSZXN0YXVyYW50YDtcclxuICBpbWFnZS5vbm1vdXNlbW92ZSA9IGltZ0hvdjtcclxuICBpbWFnZS5vbmVycm9yID0gSW1nRXJyb3I7XHJcblxyXG4gIGNvbnRhaW5lci5hcHBlbmQoaW1hZ2UpO1xyXG4gIGxpLmFwcGVuZChjb250YWluZXIpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgyXCIpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgZmF2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICBmYXYudGV4dENvbnRlbnQgPSBcIuKdpFwiO1xyXG4gIGxldCBpc0ZhdiA9IHJlc3QuaXNfZmF2b3JpdGUgPyBKU09OLnBhcnNlKHJlc3QuaXNfZmF2b3JpdGUpIDogZmFsc2U7XHJcbiAgY29uc3QgbG9jRmF2cyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibG9jX3Jlc3RfZmF2XCIpO1xyXG4gIGlmKGxvY0ZhdnMpIHtcclxuICAgIGlzRmF2ID0gSlNPTi5wYXJzZShsb2NGYXZzKVtyZXN0LmlkXSB8fCBpc0ZhdjtcclxuICB9XHJcbiAgZmF2LmNsYXNzTmFtZSA9IFwiaXMtZmF2XCIgKyAoaXNGYXYgPyBcIiB5ZXNcIiA6IFwiXCIpO1xyXG4gIGZhdi5kYXRhc2V0LmlkID0gcmVzdC5pZDtcclxuICBmYXYub25jbGljayA9IHRvZ2dsZUZhdjtcclxuICBmYXYuc2V0QXR0cmlidXRlKFxyXG4gICAgXCJhcmlhLWxhYmVsXCIsXHJcbiAgICBgY2xpY2sgdG8gJHtpc0ZhdiA/IFwicmVtb3ZlXCIgOiBcImFkZFwifSAke3Jlc3QubmFtZX0gdG8gZmF2b3JpdGVgXHJcbiAgKTtcclxuICBuYW1lLmFwcGVuZChmYXYpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2RIVE1MID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgbmVpZ2hib3Job29kSFRNTC5pbm5lckhUTUwgPSByZXN0Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kSFRNTCk7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3QuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICBtb3JlLmlubmVySFRNTCA9IFwiVmlldyBEZXRhaWxzXCI7XHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0KTtcclxuICBtb3JlLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgYENsaWNrIHRvIG9wZW4gJHtyZXN0Lm5hbWV9J3MgZGV0YWlscyBwYWdlYCk7XHJcbiAgbGkuYXBwZW5kKG1vcmUpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0cyA9IHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdHMuZm9yRWFjaChyZXN0ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0LCBuZXdNYXApO1xyXG4gICAgbWFya2VyLm9uKFwiY2xpY2tcIiwgb25DbGljayk7XHJcbiAgICBmdW5jdGlvbiBvbkNsaWNrKCkge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci5vcHRpb25zLnVybDtcclxuICAgIH1cclxuICAgIG1hcmtlcnMucHVzaChtYXJrZXIpO1xyXG4gIH0pO1xyXG5cclxufVxyXG4vKiBhZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn0gKi9cclxuXHJcbiJdfQ==
