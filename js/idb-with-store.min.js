"use strict";!function(){function e(e){return new Promise(function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function t(t,r,n){var o,i=new Promise(function(i,s){e(o=t[r].apply(t,n)).then(i,s)});return i.request=o,i}function r(e,t,r){r.forEach(function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})})}function n(e,r,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return t(this[r],o,arguments)})})}function o(e,t,r,n){n.forEach(function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})})}function i(e,r,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return e=this[r],(n=t(e,o,arguments)).then(function(e){if(e)return new c(e,n.request)});var e,n})})}function s(e){this._index=e}function c(e,t){this._cursor=e,this._request=t}function a(e){this._store=e}function u(e){this._tx=e,this.complete=new Promise(function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}})}function d(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new u(r)}function _(e){this._db=e}r(s,"_index",["name","keyPath","multiEntry","unique"]),n(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(c,"_cursor",["direction","key","primaryKey","value"]),n(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var r=this,n=arguments;return Promise.resolve().then(function(){return r._cursor[t].apply(r._cursor,n),e(r._request).then(function(e){if(e)return new c(e,r._request)})})})}),a.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},a.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},r(a,"_store",["name","keyPath","indexNames","autoIncrement"]),n(a,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(a,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(a,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new a(this._tx.objectStore.apply(this._tx,arguments))},r(u,"_tx",["objectStoreNames","mode"]),o(u,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new a(this._db.createObjectStore.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),o(d,"_db",IDBDatabase,["deleteObjectStore","close"]),_.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},r(_,"_db",["name","version","objectStoreNames"]),o(_,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[a,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,r=(t=arguments,Array.prototype.slice.call(t)),n=r[r.length-1],o=this._store||this._index,i=o[e].apply(o,r.slice(0,-1));i.onsuccess=function(){n(i.result)}})})}),[s,a].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var r=this,n=[];return new Promise(function(o){r.iterateCursor(e,function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():o(n)):o(n)})})})});var f={open:function(e,r,n){var o=t(indexedDB,"open",[e,r]),i=o.request;return i&&(i.onupgradeneeded=function(e){n&&n(new d(i.result,e.oldVersion,i.transaction))}),o.then(function(e){return new _(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=f,module.exports.default=module.exports):self.idb=f}();class __$store{constructor(){this.__db={};const e="store_restaurants";this.__db.rests=idb.open(e,1,function(t){if(!t.objectStoreNames.contains(e)){t.createObjectStore(e,{keyPath:"id"}).createIndex("by-id","id")}}),this.__db.revs=idb.open("store_reviews",1,function(e){if(!e.objectStoreNames.contains("store_reviews")){const t=e.createObjectStore("store_reviews",{keyPath:"id"});t.createIndex("by-id","id"),t.createIndex("by-restaurant_id","restaurant_id")}}),this.__db.off_revs=idb.open("store_offline-reviews",1,function(e){if(!e.objectStoreNames.contains("store_offline-reviews")){e.createObjectStore("store_offline-reviews",{keyPath:"_$id"})}})}getAllRest(){const e="store_restaurants";return this.__db.rests.then(t=>t.transaction(e).objectStore(e).getAll())}getAllRevsByRestId(e){const t="store_reviews";return this.__db.revs.then(r=>r.transaction(t).objectStore(t).index("by-restaurant_id").getAll(e))}getAllRevsByRestId_from_offline(e){return this.__db.off_revs.then(t=>t.transaction(name).objectStore(name).index("by-restaurant_id").getAll(e))}add(e,t){if(!((e="store_"+e)in this.__db))throw new Error(`${e} is invalid db`);return this.__db[e].then(r=>{const n=r.transaction(e,"readwrite");return n.objectStore(e).put(t),n.complete})}addAll(e,t){return Promise.all(t.map(t=>this.add(e,t)))}ob(e){if(!((e="store_"+e)in this.__db))throw new Error(`${e} is invalid db`);return this.__db[e].then(t=>t.transaction(e,"readwrite").objectStore(e))}}class __store{prefy(e){return`${this.__prefex}_${e}`}constructor(e,{prefex:t="store"}={}){this.__db={},this.__prefex=t;for(let{name:t,ver:r,keyPath:n,index:o}of e)t=this.prefy(t),this.__db[t]=idb.open(t,r,e=>{if(!e.objectStoreNames.contains(t)){const r=e.createObjectStore(t,{keyPath:n});o&&("string"==typeof o?r.createIndex(`by-${o}`,o):o.forEach(e=>{r.createIndex(`by-${e}`,e)}))}})}db(e){return this.__db[this.prefy(e)]}add(e,t){if(!((e=this.prefy(e))in this.__db))throw new Error(`db "${e}" not found!`);return this.__db[e].then(r=>{const n=r.transaction(e,"readwrite");return n.objectStore(e).put(t),n.complete})}ob(e){return e=this.prefy(e),this.__db[e].then(t=>t.transaction(e,"readwrite").objectStore(e))}addAll(e,t){return Promise.all(t.map(t=>this.add(e,t)))}getAllById(e,t){return e=this.prefy(e),this.__db[e].then(r=>r.transaction(e).objectStore(e).getAll(t))}getAllByIndex(e,t){return e=this.prefy(e),this.__db[e].then(r=>r.transaction(e).objectStore(e).index(`by-${t}`).getAll())}getAll(e){if(!((e=this.prefy(e))in this.__db))throw new Error(`db "${e}" not found!`);return this.__db[e].then(t=>{if(!t)return;return t.transaction(e).objectStore(e).getAll()})}del(e,t){return e=this.prefy(e),this.__db[e].then(t=>t.transaction(e,"readwrite").objectStore(e).openCursor()).then(function e(r){if(r)return t.includes(r.value._$id)&&r.delete(),r.continue().then(e)})}}const store=new __store([{name:"restaurants",keyPath:"id",ver:1,index:"id"},{name:"reviews",keyPath:"id",ver:1,index:["id","restaurant_id"]},{name:"offline-reviews",ver:1,keyPath:"_$id"}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsInN0b3JlLmpzIl0sIm5hbWVzIjpbInByb21pc2lmeVJlcXVlc3QiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwiZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJ0aGVuIiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3AiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInRoaXMiLCJzZXQiLCJ2YWwiLCJwcm94eVJlcXVlc3RNZXRob2RzIiwiQ29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJwcm94eU1ldGhvZHMiLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwidmFsdWUiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJfZGIiLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsImNyZWF0ZUluZGV4IiwiSURCT2JqZWN0U3RvcmUiLCJvYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwiY2FsbGJhY2siLCJsZW5ndGgiLCJuYXRpdmVPYmplY3QiLCJnZXRBbGwiLCJxdWVyeSIsImNvdW50IiwiaW5zdGFuY2UiLCJpdGVtcyIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiY29udGludWUiLCJleHAiLCJvcGVuIiwibmFtZSIsInZlcnNpb24iLCJ1cGdyYWRlQ2FsbGJhY2siLCJpbmRleGVkREIiLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsImRlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsImlkYiIsIl9fJHN0b3JlIiwiW29iamVjdCBPYmplY3RdIiwiX19kYiIsInJlc3RzX2RiIiwicmVzdHMiLCJ1ZGIiLCJvYmplY3RTdG9yZU5hbWVzIiwiY29udGFpbnMiLCJrZXlQYXRoIiwicmV2cyIsIm9mZl9yZXZzIiwiaWQiLCJkYXRhIiwiRXJyb3IiLCJ0eCIsInB1dCIsImFsbCIsIm1hcCIsIml0ZW0iLCJhZGQiLCJfX3N0b3JlIiwiYSIsIl9fcHJlZmV4Iiwic3RvcmVfbHN0IiwicHJlZmV4IiwidmVyIiwicHJlZnkiLCJpIiwicm0iLCJvcGVuQ3Vyc29yIiwiX2RlbCIsImluY2x1ZGVzIiwiXyRpZCJdLCJtYXBwaW5ncyI6IkFBQUEsY0FFQSxXQUtBLFNBQUFBLEVBQUFDLEdBQ0EsT0FBQSxJQUFBQyxRQUFBLFNBQUFDLEVBQUFDLEdBQ0FILEVBQUFJLFVBQUEsV0FDQUYsRUFBQUYsRUFBQUssU0FHQUwsRUFBQU0sUUFBQSxXQUNBSCxFQUFBSCxFQUFBTyxVQUtBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0EsSUFBQVgsRUFDQVksRUFBQSxJQUFBWCxRQUFBLFNBQUFDLEVBQUFDLEdBRUFKLEVBREFDLEVBQUFTLEVBQUFDLEdBQUFHLE1BQUFKLEVBQUFFLElBQ0FHLEtBQUFaLEVBQUFDLEtBSUEsT0FEQVMsRUFBQVosUUFBQUEsRUFDQVksRUFXQSxTQUFBRyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxRQUFBLFNBQUFDLEdBQ0FDLE9BQUFDLGVBQUFOLEVBQUFPLFVBQUFILEVBQUEsQ0FDQUksSUFB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U0FBQWlILEVBQUF6RixHQUNBLEdBQUFBLEVBTUEsT0FIQXVGLEVBQUFHLFNBQUExRixFQUFBTCxNQUFBZ0csT0FDQTNGLEVBQUFxRCxTQUVBckQsRUFBQTRDLFdBQUFwRSxLQUFBaUgsTUFJQSxNQUFBckYsTUFBQSxJQUFBMkUsUUFBQSxDQUNBLENBQUFoQyxLQUFBLGNBQUFvQixRQUFBLEtBQUFpQixJQUFBLEVBQUF0RixNQUFBLE1BQ0EsQ0FBQWlELEtBQUEsVUFBQW9CLFFBQUEsS0FBQWlCLElBQUEsRUFBQXRGLE1BQUEsQ0FBQSxLQUFBLGtCQUNBLENBQUFpRCxLQUFBLGtCQUFBcUMsSUFBQSxFQUFBakIsUUFBQSIsImZpbGUiOiJpZGItd2l0aC1zdG9yZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcmVxdWVzdDtcclxuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xyXG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XHJcbiAgICByZXR1cm4gcDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcclxuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xyXG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xyXG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdtdWx0aUVudHJ5JyxcclxuICAgICd1bmlxdWUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xyXG4gICAgJ2dldCcsXHJcbiAgICAnZ2V0S2V5JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEFsbEtleXMnLFxyXG4gICAgJ2NvdW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcclxuICAgICdvcGVuQ3Vyc29yJyxcclxuICAgICdvcGVuS2V5Q3Vyc29yJ1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XHJcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XHJcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xyXG4gICAgJ2RpcmVjdGlvbicsXHJcbiAgICAna2V5JyxcclxuICAgICdwcmltYXJ5S2V5JyxcclxuICAgICd2YWx1ZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXHJcbiAgICAndXBkYXRlJyxcclxuICAgICdkZWxldGUnXHJcbiAgXSk7XHJcblxyXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXHJcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xyXG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcclxuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcclxuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XHJcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xyXG4gIH1cclxuXHJcbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdpbmRleE5hbWVzJyxcclxuICAgICdhdXRvSW5jcmVtZW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdwdXQnLFxyXG4gICAgJ2FkZCcsXHJcbiAgICAnZGVsZXRlJyxcclxuICAgICdjbGVhcicsXHJcbiAgICAnZ2V0JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEtleScsXHJcbiAgICAnZ2V0QWxsS2V5cycsXHJcbiAgICAnY291bnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ29wZW5DdXJzb3InLFxyXG4gICAgJ29wZW5LZXlDdXJzb3InXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAnZGVsZXRlSW5kZXgnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XHJcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcclxuICAgICAgfTtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxyXG4gICAgJ21vZGUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXHJcbiAgICAnYWJvcnQnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xyXG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XHJcbiAgfVxyXG5cclxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ3ZlcnNpb24nLFxyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcclxuICAgICdjbG9zZSdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gREIoZGIpIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgfVxyXG5cclxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcclxuICAgICduYW1lJyxcclxuICAgICd2ZXJzaW9uJyxcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2Nsb3NlJ1xyXG4gIF0pO1xyXG5cclxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xyXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcclxuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcclxuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxyXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XHJcblxyXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcclxuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XHJcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxyXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XHJcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XHJcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcclxuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcclxuICAgICAgICAgIGlmICghY3Vyc29yKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICB2YXIgZXhwID0ge1xyXG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XHJcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xyXG5cclxuICAgICAgaWYgKHJlcXVlc3QpIHtcclxuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xyXG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIHNlbGYuaWRiID0gZXhwO1xyXG4gIH1cclxufSgpKTtcclxuIiwiLy8gcWxhYWNscmRucWxxcXJxZlxyXG5jbGFzcyBfXyRzdG9yZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9fZGIgPSB7fTtcclxuICAgIGNvbnN0IHJlc3RzX2RiID0gXCJzdG9yZV9yZXN0YXVyYW50c1wiO1xyXG4gICAgY29uc3QgcmV2c19kYiA9IFwic3RvcmVfcmV2aWV3c1wiO1xyXG4gICAgY29uc3Qgb2ZmX3JldnNfZGIgPSBcInN0b3JlX29mZmxpbmUtcmV2aWV3c1wiO1xyXG4gICAgdGhpcy5fX2RiLnJlc3RzID0gaWRiLm9wZW4ocmVzdHNfZGIsIDEsIGZ1bmN0aW9uKHVkYikge1xyXG4gICAgICBpZiAoIXVkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHJlc3RzX2RiKSkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdWRiLmNyZWF0ZU9iamVjdFN0b3JlKHJlc3RzX2RiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcclxuICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChcImJ5LWlkXCIsIFwiaWRcIik7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5fX2RiLnJldnMgPSBpZGIub3BlbihyZXZzX2RiLCAxLCBmdW5jdGlvbih1ZGIpIHtcclxuICAgICAgaWYgKCF1ZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhyZXZzX2RiKSkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdWRiLmNyZWF0ZU9iamVjdFN0b3JlKHJldnNfZGIsIHsga2V5UGF0aDogXCJpZFwiIH0pO1xyXG4gICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KFwiYnktaWRcIiwgXCJpZFwiKTtcclxuICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChcImJ5LXJlc3RhdXJhbnRfaWRcIiwgXCJyZXN0YXVyYW50X2lkXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX19kYi5vZmZfcmV2cyA9IGlkYi5vcGVuKG9mZl9yZXZzX2RiLCAxLCBmdW5jdGlvbih1ZGIpIHtcclxuICAgICAgaWYgKCF1ZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhvZmZfcmV2c19kYikpIHtcclxuICAgICAgICBjb25zdCBzdG9yZSA9IHVkYi5jcmVhdGVPYmplY3RTdG9yZShvZmZfcmV2c19kYiwgeyBrZXlQYXRoOiBcIl8kaWRcIiB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGdldEFsbFJlc3QoKSB7XHJcbiAgICBjb25zdCBuYW1lID0gXCJzdG9yZV9yZXN0YXVyYW50c1wiO1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYi5yZXN0cy50aGVuKGRiID0+XHJcbiAgICAgIGRiXHJcbiAgICAgICAgLnRyYW5zYWN0aW9uKG5hbWUpXHJcbiAgICAgICAgLm9iamVjdFN0b3JlKG5hbWUpXHJcbiAgICAgICAgLmdldEFsbCgpXHJcbiAgICApO1xyXG4gIH1cclxuICBnZXRBbGxSZXZzQnlSZXN0SWQoaWQpIHtcclxuICAgIGNvbnN0IG5hbWUgPSBcInN0b3JlX3Jldmlld3NcIjtcclxuICAgIHJldHVybiB0aGlzLl9fZGIucmV2cy50aGVuKGRiID0+XHJcbiAgICAgIGRiXHJcbiAgICAgICAgLnRyYW5zYWN0aW9uKG5hbWUpXHJcbiAgICAgICAgLm9iamVjdFN0b3JlKG5hbWUpXHJcbiAgICAgICAgLmluZGV4KFwiYnktcmVzdGF1cmFudF9pZFwiKVxyXG4gICAgICAgIC5nZXRBbGwoaWQpXHJcbiAgICApO1xyXG4gIH1cclxuICBnZXRBbGxSZXZzQnlSZXN0SWRfZnJvbV9vZmZsaW5lKGlkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fX2RiLm9mZl9yZXZzLnRoZW4oZGIgPT5cclxuICAgICAgZGJcclxuICAgICAgICAudHJhbnNhY3Rpb24obmFtZSlcclxuICAgICAgICAub2JqZWN0U3RvcmUobmFtZSlcclxuICAgICAgICAuaW5kZXgoXCJieS1yZXN0YXVyYW50X2lkXCIpXHJcbiAgICAgICAgLmdldEFsbChpZClcclxuICAgICk7XHJcbiAgfVxyXG4gIGFkZChuYW1lLCBkYXRhKSB7XHJcbiAgICBuYW1lID0gXCJzdG9yZV9cIiArIG5hbWU7XHJcbiAgICBpZiAoIShuYW1lIGluIHRoaXMuX19kYikpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke25hbWV9IGlzIGludmFsaWQgZGJgKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLl9fZGJbbmFtZV0udGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24obmFtZSwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUobmFtZSk7XHJcbiAgICAgIHN0b3JlLnB1dChkYXRhKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGFkZEFsbChuYW1lLCBpdGVtcykge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGl0ZW1zLm1hcChpdGVtID0+IHRoaXMuYWRkKG5hbWUsIGl0ZW0pKSk7XHJcbiAgfVxyXG4gIG9iKG5hbWUpIHtcclxuICAgIG5hbWUgPSBcInN0b3JlX1wiICsgbmFtZTtcclxuICAgIGlmICghKG5hbWUgaW4gdGhpcy5fX2RiKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bmFtZX0gaXMgaW52YWxpZCBkYmApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX19kYltuYW1lXS50aGVuKGRiID0+XHJcbiAgICAgIGRiLnRyYW5zYWN0aW9uKG5hbWUsIFwicmVhZHdyaXRlXCIpLm9iamVjdFN0b3JlKG5hbWUpXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgX19zdG9yZSB7XHJcbiAgcHJlZnkoYSkge1xyXG4gICAgcmV0dXJuIGAke3RoaXMuX19wcmVmZXh9XyR7YX1gO1xyXG4gIH1cclxuICBjb25zdHJ1Y3RvcihzdG9yZV9sc3QsIHsgcHJlZmV4ID0gXCJzdG9yZVwiIH0gPSB7fSkge1xyXG4gICAgdGhpcy5fX2RiID0ge307XHJcbiAgICB0aGlzLl9fcHJlZmV4ID0gcHJlZmV4O1xyXG4gICAgZm9yIChsZXQgeyBuYW1lLCB2ZXIsIGtleVBhdGgsIGluZGV4IH0gb2Ygc3RvcmVfbHN0KSB7XHJcbiAgICAgIG5hbWUgPSB0aGlzLnByZWZ5KG5hbWUpO1xyXG4gICAgICB0aGlzLl9fZGJbbmFtZV0gPSBpZGIub3BlbihuYW1lLCB2ZXIsIHVkYiA9PiB7XHJcbiAgICAgICAgaWYgKCF1ZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhuYW1lKSkge1xyXG4gICAgICAgICAgY29uc3Qgc3RvcmUgPSB1ZGIuY3JlYXRlT2JqZWN0U3RvcmUobmFtZSwgeyBrZXlQYXRoIH0pO1xyXG4gICAgICAgICAgaWYgKGluZGV4KSB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5kZXggPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChgYnktJHtpbmRleH1gLCBpbmRleCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgaW5kZXguZm9yRWFjaChpID0+IHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KGBieS0ke2l9YCwgaSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuICBkYihuYW1lKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fX2RiW3RoaXMucHJlZnkobmFtZSldO1xyXG4gIH1cclxuICBhZGQobmFtZSwgdmFsdWUpIHtcclxuICAgIG5hbWUgPSB0aGlzLnByZWZ5KG5hbWUpO1xyXG4gICAgaWYgKCEobmFtZSBpbiB0aGlzLl9fZGIpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgZGIgXCIke25hbWV9XCIgbm90IGZvdW5kIWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX19kYltuYW1lXS50aGVuKGRiID0+IHtcclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihuYW1lLCBcInJlYWR3cml0ZVwiKTtcclxuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShuYW1lKTtcclxuICAgICAgc3RvcmUucHV0KHZhbHVlKTtcclxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIG9iKHN0b3JlKSB7XHJcbiAgICBzdG9yZSA9IHRoaXMucHJlZnkoc3RvcmUpO1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYltzdG9yZV0udGhlbihkYiA9PlxyXG4gICAgICBkYi50cmFuc2FjdGlvbihzdG9yZSwgXCJyZWFkd3JpdGVcIikub2JqZWN0U3RvcmUoc3RvcmUpXHJcbiAgICApO1xyXG4gIH1cclxuICBhZGRBbGwoZGIsIGl0ZW1zKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoaXRlbXMubWFwKGl0ZW0gPT4gdGhpcy5hZGQoZGIsIGl0ZW0pKSk7XHJcbiAgICAvLyBmb3IgKGNvbnN0IGl0ZW0gb2YgYXJyKSB7XHJcbiAgICAvLyAgIGF3YWl0IHRoaXMuYWRkKGRiLCBpdGVtKTtcclxuICAgIC8vIH1cclxuICB9XHJcbiAgZ2V0QWxsQnlJZChzdG9yZSwgaWQpIHtcclxuICAgIHN0b3JlID0gdGhpcy5wcmVmeShzdG9yZSk7XHJcbiAgICByZXR1cm4gdGhpcy5fX2RiW3N0b3JlXS50aGVuKGRiID0+XHJcbiAgICAgIGRiXHJcbiAgICAgICAgLnRyYW5zYWN0aW9uKHN0b3JlKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShzdG9yZSlcclxuICAgICAgICAuZ2V0QWxsKGlkKVxyXG4gICAgKTtcclxuICB9XHJcbiAgZ2V0QWxsQnlJbmRleChzdG9yZSwgaW5kZXgpIHtcclxuICAgIHN0b3JlID0gdGhpcy5wcmVmeShzdG9yZSk7XHJcbiAgICByZXR1cm4gdGhpcy5fX2RiW3N0b3JlXS50aGVuKGRiID0+IHtcclxuICAgICAgcmV0dXJuIGRiXHJcbiAgICAgICAgLnRyYW5zYWN0aW9uKHN0b3JlKVxyXG4gICAgICAgIC5vYmplY3RTdG9yZShzdG9yZSlcclxuICAgICAgICAuaW5kZXgoYGJ5LSR7aW5kZXh9YClcclxuICAgICAgICAuZ2V0QWxsKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZ2V0QWxsKHN0b3JlKSB7XHJcbiAgICBzdG9yZSA9IHRoaXMucHJlZnkoc3RvcmUpO1xyXG4gICAgaWYgKCEoc3RvcmUgaW4gdGhpcy5fX2RiKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGRiIFwiJHtzdG9yZX1cIiBub3QgZm91bmQhYCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5fX2RiW3N0b3JlXS50aGVuKGRiID0+IHtcclxuICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlKTtcclxuICAgICAgcmV0dXJuIHR4Lm9iamVjdFN0b3JlKHN0b3JlKS5nZXRBbGwoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBkZWwoc3RvcmUsIHJtKSB7XHJcbiAgICBzdG9yZSA9IHRoaXMucHJlZnkoc3RvcmUpO1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYltzdG9yZV1cclxuICAgICAgLnRoZW4oZGIgPT5cclxuICAgICAgICBkYlxyXG4gICAgICAgICAgLnRyYW5zYWN0aW9uKHN0b3JlLCBcInJlYWR3cml0ZVwiKVxyXG4gICAgICAgICAgLm9iamVjdFN0b3JlKHN0b3JlKVxyXG4gICAgICAgICAgLm9wZW5DdXJzb3IoKVxyXG4gICAgICApXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uIF9kZWwoY3Vyc29yKSB7XHJcbiAgICAgICAgaWYgKCFjdXJzb3IpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJtLmluY2x1ZGVzKGN1cnNvci52YWx1ZS5fJGlkKSkge1xyXG4gICAgICAgICAgY3Vyc29yLmRlbGV0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY3Vyc29yLmNvbnRpbnVlKCkudGhlbihfZGVsKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcbmNvbnN0IHN0b3JlID0gbmV3IF9fc3RvcmUoW1xyXG4gIHsgbmFtZTogXCJyZXN0YXVyYW50c1wiLCBrZXlQYXRoOiBcImlkXCIsIHZlcjogMSwgaW5kZXg6IFwiaWRcIiB9LFxyXG4gIHsgbmFtZTogXCJyZXZpZXdzXCIsIGtleVBhdGg6IFwiaWRcIiwgdmVyOiAxLCBpbmRleDogW1wiaWRcIiwgXCJyZXN0YXVyYW50X2lkXCJdIH0sXHJcbiAgeyBuYW1lOiBcIm9mZmxpbmUtcmV2aWV3c1wiLCB2ZXI6IDEsIGtleVBhdGg6IFwiXyRpZFwiIH1cclxuXSk7XHJcbiJdfQ==
