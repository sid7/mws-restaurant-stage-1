"use strict";!function(){function e(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function t(t,n,r){var o,i=new Promise(function(i,s){e(o=t[n].apply(t,r)).then(i,s)});return i.request=o,i}function n(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return t(this[n],o,arguments)})})}function o(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function i(e,n,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return e=this[n],(r=t(e,o,arguments)).then(function(e){if(e)return new u(e,r.request)});var e,r})})}function s(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function a(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function d(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new a(n)}function p(e){this._db=e}n(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),i(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(u.prototype[t]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[t].apply(n._cursor,r),e(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),c.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},n(c,"_store",["name","keyPath","indexNames","autoIncrement"]),r(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),i(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(c,"_store",IDBObjectStore,["deleteIndex"]),a.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},n(a,"_tx",["objectStoreNames","mode"]),o(a,"_tx",IDBTransaction,["abort"]),d.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},n(d,"_db",["name","version","objectStoreNames"]),o(d,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),o(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[c,s].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),r=n[n.length-1],o=this._store||this._index,i=o[e].apply(o,n.slice(0,-1));i.onsuccess=function(){r(i.result)}})})}),[s,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():o(r)):o(r)})})})});var f={open:function(e,n,r){var o=t(indexedDB,"open",[e,n]),i=o.request;return i&&(i.onupgradeneeded=function(e){r&&r(new d(i.result,e.oldVersion,i.transaction))}),o.then(function(e){return new p(e)})},delete:function(e){return t(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=f,module.exports.default=module.exports):self.idb=f}();class __store{prefy(e){return`${this.__prefex}_${e}`}constructor(e,{prefex:t="store"}={}){this.__db={},this.__prefex=t;for(let{name:t,ver:n,keyPath:r,index:o}of e)t=this.prefy(t),this.__db[t]=idb.open(t,n,e=>{if(!e.objectStoreNames.contains(t)){const n=e.createObjectStore(t,{keyPath:r});o&&("string"==typeof o?n.createIndex(`by-${o}`,o):o.forEach(e=>{n.createIndex(`by-${e}`,e)}))}})}db(e){return this.__db[this.prefy(e)]}add(e,t){if(!((e=this.prefy(e))in this.__db))throw new Error(`db "${e}" not found!`);return this.__db[e].then(n=>{const r=n.transaction(e,"readwrite");return r.objectStore(e).put(t),r.complete})}ob(e){return e=this.prefy(e),this.__db[e].then(t=>t.transaction(e,"readwrite").objectStore(e))}addAll(e,t){return Promise.all(t.map(t=>this.add(e,t)))}getAllById(e,t){return e=this.prefy(e),this.__db[e].then(n=>n.transaction(e).objectStore(e).getAll(t))}getAllByIndex(e,t){return e=this.prefy(e),this.__db[e].then(n=>n.transaction(e).objectStore(e).index(`by-${t}`).getAll())}getAll(e){if(!((e=this.prefy(e))in this.__db))throw new Error(`db "${e}" not found!`);return this.__db[e].then(t=>{if(!t)return;return t.transaction(e).objectStore(e).getAll()})}del(e,t){return e=this.prefy(e),this.__db[e].then(t=>t.transaction(e,"readwrite").objectStore(e).openCursor()).then(function e(n){if(n)return t.includes(n.value._$id)&&n.delete(),n.continue().then(e)})}}const store=new __store([{name:"restaurants",keyPath:"id",ver:1,index:"id"},{name:"reviews",keyPath:"id",ver:1,index:["id","restaurant_id"]},{name:"offline-reviews",ver:1,keyPath:"_$id"}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsInN0b3JlLmpzIl0sIm5hbWVzIjpbInByb21pc2lmeVJlcXVlc3QiLCJyZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbnN1Y2Nlc3MiLCJyZXN1bHQiLCJvbmVycm9yIiwiZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJ0aGVuIiwicHJveHlQcm9wZXJ0aWVzIiwiUHJveHlDbGFzcyIsInRhcmdldFByb3AiLCJwcm9wZXJ0aWVzIiwiZm9yRWFjaCIsInByb3AiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInRoaXMiLCJzZXQiLCJ2YWwiLCJwcm94eVJlcXVlc3RNZXRob2RzIiwiQ29uc3RydWN0b3IiLCJhcmd1bWVudHMiLCJwcm94eU1ldGhvZHMiLCJwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzIiwidmFsdWUiLCJDdXJzb3IiLCJJbmRleCIsImluZGV4IiwiX2luZGV4IiwiY3Vyc29yIiwiX2N1cnNvciIsIl9yZXF1ZXN0IiwiT2JqZWN0U3RvcmUiLCJzdG9yZSIsIl9zdG9yZSIsIlRyYW5zYWN0aW9uIiwiaWRiVHJhbnNhY3Rpb24iLCJfdHgiLCJjb21wbGV0ZSIsIm9uY29tcGxldGUiLCJvbmFib3J0IiwiVXBncmFkZURCIiwiZGIiLCJvbGRWZXJzaW9uIiwidHJhbnNhY3Rpb24iLCJfZGIiLCJEQiIsIklEQkluZGV4IiwiSURCQ3Vyc29yIiwibWV0aG9kTmFtZSIsImNyZWF0ZUluZGV4IiwiSURCT2JqZWN0U3RvcmUiLCJvYmplY3RTdG9yZSIsIklEQlRyYW5zYWN0aW9uIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwiY2FsbGJhY2siLCJsZW5ndGgiLCJuYXRpdmVPYmplY3QiLCJnZXRBbGwiLCJxdWVyeSIsImNvdW50IiwiaW5zdGFuY2UiLCJpdGVtcyIsIml0ZXJhdGVDdXJzb3IiLCJwdXNoIiwidW5kZWZpbmVkIiwiY29udGludWUiLCJleHAiLCJvcGVuIiwibmFtZSIsInZlcnNpb24iLCJ1cGdyYWRlQ2FsbGJhY2siLCJpbmRleGVkREIiLCJvbnVwZ3JhZGVuZWVkZWQiLCJldmVudCIsImRlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJkZWZhdWx0Iiwic2VsZiIsImlkYiIsIl9fc3RvcmUiLCJbb2JqZWN0IE9iamVjdF0iLCJhIiwiX19wcmVmZXgiLCJzdG9yZV9sc3QiLCJwcmVmZXgiLCJfX2RiIiwidmVyIiwia2V5UGF0aCIsInByZWZ5IiwidWRiIiwib2JqZWN0U3RvcmVOYW1lcyIsImNvbnRhaW5zIiwiaSIsIkVycm9yIiwidHgiLCJwdXQiLCJhbGwiLCJtYXAiLCJpdGVtIiwiYWRkIiwiaWQiLCJybSIsIm9wZW5DdXJzb3IiLCJfZGVsIiwiaW5jbHVkZXMiLCJfJGlkIl0sIm1hcHBpbmdzIjoiQUFBQSxjQUVBLFdBS0EsU0FBQUEsRUFBQUMsR0FDQSxPQUFBLElBQUFDLFFBQUEsU0FBQUMsRUFBQUMsR0FDQUgsRUFBQUksVUFBQSxXQUNBRixFQUFBRixFQUFBSyxTQUdBTCxFQUFBTSxRQUFBLFdBQ0FILEVBQUFILEVBQUFPLFVBS0EsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxJQUFBWCxFQUNBWSxFQUFBLElBQUFYLFFBQUEsU0FBQUMsRUFBQUMsR0FFQUosRUFEQUMsRUFBQVMsRUFBQUMsR0FBQUcsTUFBQUosRUFBQUUsSUFDQUcsS0FBQVosRUFBQUMsS0FJQSxPQURBUyxFQUFBWixRQUFBQSxFQUNBWSxFQVdBLFNBQUFHLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FBLEVBQUFDLFFBQUEsU0FBQUMsR0FDQUMsT0FBQUMsZUFBQU4sRUFBQU8sVUFBQUgsRUFBQSxDQUNBSSxJQUFBLFdBQ0EsT0FBQUMsS0FBQVIsR0FBQUcsSUFFQU0sSUFBQSxTQUFBQyxHQUNBRixLQUFBUixH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RUFBQWpCLEtBQUFpRixNQUFBaEUsR0FDQWpCLEtBQUE4RSxLQUFBN0QsR0FBQTVCLEtBQUFxQyxHQUNBQSxFQUNBRSxZQUFBWCxHQUNBbUIsWUFBQW5CLEdBQ0FOLFlBQUFBLEtBQ0FzQyxVQUdBd0IsT0FBQXhELEdBRUEsTUFEQUEsRUFBQWpCLEtBQUFpRixNQUFBaEUsTUFDQWpCLEtBQUE4RSxNQUNBLE1BQUEsSUFBQVEsYUFBQXJFLGlCQUVBLE9BQUFqQixLQUFBOEUsS0FBQTdELEdBQUE1QixLQUFBcUMsSUFDQSxJQUFBQSxFQUNBLE9BR0EsT0FEQUEsRUFBQUUsWUFBQVgsR0FDQW1CLFlBQUFuQixHQUFBZ0MsV0FHQXdCLElBQUF4RCxFQUFBNkUsR0FFQSxPQURBN0UsRUFBQWpCLEtBQUFpRixNQUFBaEUsR0FDQWpCLEtBQUE4RSxLQUFBN0QsR0FDQTVCLEtBQUFxQyxHQUNBQSxFQUNBRSxZQUFBWCxFQUFBLGFBQ0FtQixZQUFBbkIsR0FDQThFLGNBRUExRyxLQUFBLFNBQUEyRyxFQUFBbkYsR0FDQSxHQUFBQSxFQU1BLE9BSEFpRixFQUFBRyxTQUFBcEYsRUFBQUwsTUFBQTBGLE9BQ0FyRixFQUFBcUQsU0FFQXJELEVBQUE0QyxXQUFBcEUsS0FBQTJHLE1BSUEsTUFBQS9FLE1BQUEsSUFBQXVELFFBQUEsQ0FDQSxDQUFBWixLQUFBLGNBQUFvQixRQUFBLEtBQUFELElBQUEsRUFBQXBFLE1BQUEsTUFDQSxDQUFBaUQsS0FBQSxVQUFBb0IsUUFBQSxLQUFBRCxJQUFBLEVBQUFwRSxNQUFBLENBQUEsS0FBQSxrQkFDQSxDQUFBaUQsS0FBQSxrQkFBQW1CLElBQUEsRUFBQUMsUUFBQSIsImZpbGUiOiJpZGItd2l0aC1zdG9yZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgZnVuY3Rpb24gdG9BcnJheShhcnIpIHtcclxuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcmVxdWVzdDtcclxuICAgIHZhciBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xyXG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XHJcbiAgICByZXR1cm4gcDtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XHJcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcclxuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuO1xyXG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpc1t0YXJnZXRQcm9wXVtwcm9wXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XHJcbiAgICAgICAgICB0aGlzW3RhcmdldFByb3BdW3Byb3BdID0gdmFsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5UmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBwcm94eU1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoUHJveHlDbGFzcywgdGFyZ2V0UHJvcCwgQ29uc3RydWN0b3IsIHByb3BlcnRpZXMpIHtcclxuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XHJcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgICBQcm94eUNsYXNzLnByb3RvdHlwZVtwcm9wXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBJbmRleChpbmRleCkge1xyXG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdtdWx0aUVudHJ5JyxcclxuICAgICd1bmlxdWUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xyXG4gICAgJ2dldCcsXHJcbiAgICAnZ2V0S2V5JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEFsbEtleXMnLFxyXG4gICAgJ2NvdW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcclxuICAgICdvcGVuQ3Vyc29yJyxcclxuICAgICdvcGVuS2V5Q3Vyc29yJ1xyXG4gIF0pO1xyXG5cclxuICBmdW5jdGlvbiBDdXJzb3IoY3Vyc29yLCByZXF1ZXN0KSB7XHJcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XHJcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICB9XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xyXG4gICAgJ2RpcmVjdGlvbicsXHJcbiAgICAna2V5JyxcclxuICAgICdwcmltYXJ5S2V5JyxcclxuICAgICd2YWx1ZSdcclxuICBdKTtcclxuXHJcbiAgcHJveHlSZXF1ZXN0TWV0aG9kcyhDdXJzb3IsICdfY3Vyc29yJywgSURCQ3Vyc29yLCBbXHJcbiAgICAndXBkYXRlJyxcclxuICAgICdkZWxldGUnXHJcbiAgXSk7XHJcblxyXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXHJcbiAgWydhZHZhbmNlJywgJ2NvbnRpbnVlJywgJ2NvbnRpbnVlUHJpbWFyeUtleSddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kTmFtZSkge1xyXG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xyXG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgY3Vyc29yID0gdGhpcztcclxuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGN1cnNvci5fY3Vyc29yW21ldGhvZE5hbWVdLmFwcGx5KGN1cnNvci5fY3Vyc29yLCBhcmdzKTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcclxuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcclxuICAgICAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBjdXJzb3IuX3JlcXVlc3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGZ1bmN0aW9uIE9iamVjdFN0b3JlKHN0b3JlKSB7XHJcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xyXG4gIH1cclxuXHJcbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5fc3RvcmUuaW5kZXguYXBwbHkodGhpcy5fc3RvcmUsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIFtcclxuICAgICduYW1lJyxcclxuICAgICdrZXlQYXRoJyxcclxuICAgICdpbmRleE5hbWVzJyxcclxuICAgICdhdXRvSW5jcmVtZW50J1xyXG4gIF0pO1xyXG5cclxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcclxuICAgICdwdXQnLFxyXG4gICAgJ2FkZCcsXHJcbiAgICAnZGVsZXRlJyxcclxuICAgICdjbGVhcicsXHJcbiAgICAnZ2V0JyxcclxuICAgICdnZXRBbGwnLFxyXG4gICAgJ2dldEtleScsXHJcbiAgICAnZ2V0QWxsS2V5cycsXHJcbiAgICAnY291bnQnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xyXG4gICAgJ29wZW5DdXJzb3InLFxyXG4gICAgJ29wZW5LZXlDdXJzb3InXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXHJcbiAgICAnZGVsZXRlSW5kZXgnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XHJcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xyXG4gICAgdGhpcy5jb21wbGV0ZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcclxuICAgICAgfTtcclxuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XHJcbiAgfTtcclxuXHJcbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnLFxyXG4gICAgJ21vZGUnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXHJcbiAgICAnYWJvcnQnXHJcbiAgXSk7XHJcblxyXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xyXG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XHJcbiAgfVxyXG5cclxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IE9iamVjdFN0b3JlKHRoaXMuX2RiLmNyZWF0ZU9iamVjdFN0b3JlLmFwcGx5KHRoaXMuX2RiLCBhcmd1bWVudHMpKTtcclxuICB9O1xyXG5cclxuICBwcm94eVByb3BlcnRpZXMoVXBncmFkZURCLCAnX2RiJywgW1xyXG4gICAgJ25hbWUnLFxyXG4gICAgJ3ZlcnNpb24nLFxyXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXHJcbiAgXSk7XHJcblxyXG4gIHByb3h5TWV0aG9kcyhVcGdyYWRlREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcclxuICAgICdjbG9zZSdcclxuICBdKTtcclxuXHJcbiAgZnVuY3Rpb24gREIoZGIpIHtcclxuICAgIHRoaXMuX2RiID0gZGI7XHJcbiAgfVxyXG5cclxuICBEQi5wcm90b3R5cGUudHJhbnNhY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xyXG4gIH07XHJcblxyXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcclxuICAgICduYW1lJyxcclxuICAgICd2ZXJzaW9uJyxcclxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xyXG4gIF0pO1xyXG5cclxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xyXG4gICAgJ2Nsb3NlJ1xyXG4gIF0pO1xyXG5cclxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xyXG4gIC8vIFRPRE86IHJlbW92ZSB0aGlzIG9uY2UgYnJvd3NlcnMgZG8gdGhlIHJpZ2h0IHRoaW5nIHdpdGggcHJvbWlzZXNcclxuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcclxuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgICAgLy8gRG9uJ3QgY3JlYXRlIGl0ZXJhdGVLZXlDdXJzb3IgaWYgb3BlbktleUN1cnNvciBkb2Vzbid0IGV4aXN0LlxyXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XHJcblxyXG4gICAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGVbZnVuY05hbWUucmVwbGFjZSgnb3BlbicsICdpdGVyYXRlJyldID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XHJcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgIHZhciBuYXRpdmVPYmplY3QgPSB0aGlzLl9zdG9yZSB8fCB0aGlzLl9pbmRleDtcclxuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XHJcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKHJlcXVlc3QucmVzdWx0KTtcclxuICAgICAgICB9O1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIHBvbHlmaWxsIGdldEFsbFxyXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcclxuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XHJcbiAgICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24ocXVlcnksIGNvdW50KSB7XHJcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xyXG5cclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcclxuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcclxuICAgICAgICAgIGlmICghY3Vyc29yKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgaWYgKGNvdW50ICE9PSB1bmRlZmluZWQgJiYgaXRlbXMubGVuZ3RoID09IGNvdW50KSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICB2YXIgZXhwID0ge1xyXG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnb3BlbicsIFtuYW1lLCB2ZXJzaW9uXSk7XHJcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xyXG5cclxuICAgICAgaWYgKHJlcXVlc3QpIHtcclxuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHVwZ3JhZGVDYWxsYmFjayhuZXcgVXBncmFkZURCKHJlcXVlc3QucmVzdWx0LCBldmVudC5vbGRWZXJzaW9uLCByZXF1ZXN0LnRyYW5zYWN0aW9uKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xyXG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xyXG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xyXG4gIH1cclxuICBlbHNlIHtcclxuICAgIHNlbGYuaWRiID0gZXhwO1xyXG4gIH1cclxufSgpKTtcclxuIiwiXHJcbmNsYXNzIF9fc3RvcmUge1xyXG4gIHByZWZ5KGEpIHtcclxuICAgIHJldHVybiBgJHt0aGlzLl9fcHJlZmV4fV8ke2F9YDtcclxuICB9XHJcbiAgY29uc3RydWN0b3Ioc3RvcmVfbHN0LCB7IHByZWZleCA9IFwic3RvcmVcIiB9ID0ge30pIHtcclxuICAgIHRoaXMuX19kYiA9IHt9O1xyXG4gICAgdGhpcy5fX3ByZWZleCA9IHByZWZleDtcclxuICAgIGZvciAobGV0IHsgbmFtZSwgdmVyLCBrZXlQYXRoLCBpbmRleCB9IG9mIHN0b3JlX2xzdCkge1xyXG4gICAgICBuYW1lID0gdGhpcy5wcmVmeShuYW1lKTtcclxuICAgICAgdGhpcy5fX2RiW25hbWVdID0gaWRiLm9wZW4obmFtZSwgdmVyLCB1ZGIgPT4ge1xyXG4gICAgICAgIGlmICghdWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMobmFtZSkpIHtcclxuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdWRiLmNyZWF0ZU9iamVjdFN0b3JlKG5hbWUsIHsga2V5UGF0aCB9KTtcclxuICAgICAgICAgIGlmIChpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGluZGV4ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoYGJ5LSR7aW5kZXh9YCwgaW5kZXgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGluZGV4LmZvckVhY2goaSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZS5jcmVhdGVJbmRleChgYnktJHtpfWAsIGkpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgZGIobmFtZSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYlt0aGlzLnByZWZ5KG5hbWUpXTtcclxuICB9XHJcbiAgYWRkKG5hbWUsIHZhbHVlKSB7XHJcbiAgICBuYW1lID0gdGhpcy5wcmVmeShuYW1lKTtcclxuICAgIGlmICghKG5hbWUgaW4gdGhpcy5fX2RiKSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGRiIFwiJHtuYW1lfVwiIG5vdCBmb3VuZCFgKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLl9fZGJbbmFtZV0udGhlbihkYiA9PiB7XHJcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24obmFtZSwgXCJyZWFkd3JpdGVcIik7XHJcbiAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUobmFtZSk7XHJcbiAgICAgIHN0b3JlLnB1dCh2YWx1ZSk7XHJcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBvYihzdG9yZSkge1xyXG4gICAgc3RvcmUgPSB0aGlzLnByZWZ5KHN0b3JlKTtcclxuICAgIHJldHVybiB0aGlzLl9fZGJbc3RvcmVdLnRoZW4oZGIgPT5cclxuICAgICAgZGIudHJhbnNhY3Rpb24oc3RvcmUsIFwicmVhZHdyaXRlXCIpLm9iamVjdFN0b3JlKHN0b3JlKVxyXG4gICAgKTtcclxuICB9XHJcbiAgYWRkQWxsKGRiLCBpdGVtcykge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGl0ZW1zLm1hcChpdGVtID0+IHRoaXMuYWRkKGRiLCBpdGVtKSkpO1xyXG4gICAgLy8gZm9yIChjb25zdCBpdGVtIG9mIGFycikge1xyXG4gICAgLy8gICBhd2FpdCB0aGlzLmFkZChkYiwgaXRlbSk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIGdldEFsbEJ5SWQoc3RvcmUsIGlkKSB7XHJcbiAgICBzdG9yZSA9IHRoaXMucHJlZnkoc3RvcmUpO1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYltzdG9yZV0udGhlbihkYiA9PlxyXG4gICAgICBkYlxyXG4gICAgICAgIC50cmFuc2FjdGlvbihzdG9yZSlcclxuICAgICAgICAub2JqZWN0U3RvcmUoc3RvcmUpXHJcbiAgICAgICAgLmdldEFsbChpZClcclxuICAgICk7XHJcbiAgfVxyXG4gIGdldEFsbEJ5SW5kZXgoc3RvcmUsIGluZGV4KSB7XHJcbiAgICBzdG9yZSA9IHRoaXMucHJlZnkoc3RvcmUpO1xyXG4gICAgcmV0dXJuIHRoaXMuX19kYltzdG9yZV0udGhlbihkYiA9PiB7XHJcbiAgICAgIHJldHVybiBkYlxyXG4gICAgICAgIC50cmFuc2FjdGlvbihzdG9yZSlcclxuICAgICAgICAub2JqZWN0U3RvcmUoc3RvcmUpXHJcbiAgICAgICAgLmluZGV4KGBieS0ke2luZGV4fWApXHJcbiAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGdldEFsbChzdG9yZSkge1xyXG4gICAgc3RvcmUgPSB0aGlzLnByZWZ5KHN0b3JlKTtcclxuICAgIGlmICghKHN0b3JlIGluIHRoaXMuX19kYikpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBkYiBcIiR7c3RvcmV9XCIgbm90IGZvdW5kIWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX19kYltzdG9yZV0udGhlbihkYiA9PiB7XHJcbiAgICAgIGlmICghZGIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihzdG9yZSk7XHJcbiAgICAgIHJldHVybiB0eC5vYmplY3RTdG9yZShzdG9yZSkuZ2V0QWxsKCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZGVsKHN0b3JlLCBybSkge1xyXG4gICAgc3RvcmUgPSB0aGlzLnByZWZ5KHN0b3JlKTtcclxuICAgIHJldHVybiB0aGlzLl9fZGJbc3RvcmVdXHJcbiAgICAgIC50aGVuKGRiID0+XHJcbiAgICAgICAgZGJcclxuICAgICAgICAgIC50cmFuc2FjdGlvbihzdG9yZSwgXCJyZWFkd3JpdGVcIilcclxuICAgICAgICAgIC5vYmplY3RTdG9yZShzdG9yZSlcclxuICAgICAgICAgIC5vcGVuQ3Vyc29yKClcclxuICAgICAgKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiBfZGVsKGN1cnNvcikge1xyXG4gICAgICAgIGlmICghY3Vyc29yKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChybS5pbmNsdWRlcyhjdXJzb3IudmFsdWUuXyRpZCkpIHtcclxuICAgICAgICAgIGN1cnNvci5kZWxldGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGN1cnNvci5jb250aW51ZSgpLnRoZW4oX2RlbCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxufVxyXG5jb25zdCBzdG9yZSA9IG5ldyBfX3N0b3JlKFtcclxuICB7IG5hbWU6IFwicmVzdGF1cmFudHNcIiwga2V5UGF0aDogXCJpZFwiLCB2ZXI6IDEsIGluZGV4OiBcImlkXCIgfSxcclxuICB7IG5hbWU6IFwicmV2aWV3c1wiLCBrZXlQYXRoOiBcImlkXCIsIHZlcjogMSwgaW5kZXg6IFtcImlkXCIsIFwicmVzdGF1cmFudF9pZFwiXSB9LFxyXG4gIHsgbmFtZTogXCJvZmZsaW5lLXJldmlld3NcIiwgdmVyOiAxLCBrZXlQYXRoOiBcIl8kaWRcIiB9XHJcbl0pO1xyXG4iXX0=
